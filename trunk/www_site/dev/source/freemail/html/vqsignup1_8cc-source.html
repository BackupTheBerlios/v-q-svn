<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>vqwww: freemail: vqsignup1.cc Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.3 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Compound&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Compound&nbsp;Members</a></div>
<h1>vqsignup1.cc</h1><div class="fragment"><pre>00001 
00034 <span class="preprocessor">#include &lt;memory&gt;</span>
00035 <span class="preprocessor">#include &lt;unistd.h&gt;</span>
00036 <span class="preprocessor">#include &lt;iostream&gt;</span>
00037 <span class="preprocessor">#include &lt;string&gt;</span>
00038 <span class="preprocessor">#include &lt;stdexcept&gt;</span>
00039 <span class="preprocessor">#include &lt;cgicc/Cgicc.h&gt;</span>
00040 <span class="preprocessor">#include &lt;deque&gt;</span>
00041 <span class="preprocessor">#include &lt;fstream&gt;</span>
00042 <span class="preprocessor">#include &lt;cerrno&gt;</span>
00043 <span class="preprocessor">#include &lt;algorithm&gt;</span>
00044 <span class="preprocessor">#include &lt;sstream&gt;</span>
00045 
00046 <span class="preprocessor">#include &lt;pqxx/all.h&gt;</span>
00047 
00048 <span class="preprocessor">#include &lt;cvq.h&gt;</span>
00049 <span class="preprocessor">#include &lt;util.h&gt;</span>
00050 <span class="preprocessor">#include &lt;sig.h&gt;</span>
00051 <span class="preprocessor">#include &lt;valid.h&gt;</span>
00052 <span class="preprocessor">#include &lt;lower.h&gt;</span>
00053 
00054 <span class="preprocessor">#include "cdbdaemon.h"</span>
00055 <span class="preprocessor">#include "cgi.h"</span>
00056 <span class="preprocessor">#include "freemail_conf.h"</span>
00057 <span class="preprocessor">#include "html.h"</span>
00058 <span class="preprocessor">#include "sabmain.h"</span>
00059 
00060 <span class="keyword">using</span> <span class="keyword">namespace </span>std;
00061 <span class="keyword">using</span> <span class="keyword">namespace </span>cgicc;
00062 <span class="keyword">using</span> <span class="keyword">namespace </span>freemail;
00063 <span class="keyword">using</span> <span class="keyword">namespace </span>valid;
00064 
00065 <span class="keyword">const</span> <span class="keywordtype">char</span> *me= NULL;
00066 
00067 Cgicc *cgi=NULL;
00068 const_form_iterator cgie;
00069 <span class="keyword">const</span> CgiEnvironment *ce = NULL;
00070 
00071 ostream *o=NULL, *e=NULL;
00072 
00073 <a class="code" href="classcdbdaemon.html">cdbdaemon</a> *db = NULL;
00074 
00075 string localeinfo; <span class="comment">// localization information (for example pl_PL)</span>
00076 vector&lt;cdbdaemon::domain_info&gt; domains;
00077 vector&lt;cdbdaemon::edu_info&gt; edu_levs;
00078 vector&lt;cdbdaemon::work_info&gt; works;
00079 vector&lt;cdbdaemon::int_info&gt; ints;
00080 vector&lt;cdbdaemon::area_info&gt; areas;
00081 vector&lt;cdbdaemon::sex_info&gt; sexes;
00082 
00083 <a class="code" href="structcdbdaemon_1_1user__info.html">cdbdaemon::user_info</a> ui;
00084 string pass, pass1;
00085 <span class="keyword">const</span> <span class="keywordtype">char</span> *iid=NULL; <span class="comment">// id from users_info</span>
00086 
00089 <span class="keywordtype">void</span> notify_run() {
00090     <span class="keywordtype">char</span> *av[] = { 
00091             (<span class="keywordtype">char</span> *)ac_notify.<a class="code" href="classclnconf.html#clnconfa1">val_str</a>().c_str(), 
00092             (<span class="keywordtype">char</span> *)ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo2">dom_id</a>.c_str(), 
00093             (<span class="keywordtype">char</span> *)ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo1">login</a>.c_str(), (<span class="keywordtype">char</span> *)iid, NULL };
00094     <span class="keywordflow">switch</span>(vfork()) {
00095     <span class="keywordflow">case</span> -1:
00096       *e&lt;&lt;me&lt;&lt;<span class="stringliteral">": vfork failed: "</span>&lt;&lt;strerror(errno)&lt;&lt;endl;
00097       <span class="keywordflow">break</span>;
00098     <span class="keywordflow">case</span> 0:
00099       execvp( *av, av );
00100       *e&lt;&lt;me&lt;&lt;<span class="stringliteral">": execvp: "</span>&lt;&lt; ac_notify.<a class="code" href="classclnconf.html#clnconfa1">val_str</a>() &lt;&lt;<span class="stringliteral">": "</span>&lt;&lt;strerror(errno)&lt;&lt;endl;
00101       _exit(1);
00102     }
00103 }
00107 <span class="keywordtype">void</span> form2ints() {
00108   ostringstream int_name;
00109   string inter;
00110   vector&lt;cdbdaemon::int_info&gt;::size_type i, cnt;
00111   vector&lt;cdbdaemon::int_info&gt;::const_iterator icur, iend = ints.end();
00112   <span class="keywordflow">for</span>( i=1, cnt=ints.size(); i&lt;=cnt; ++i ) {
00113     int_name.str(<span class="stringliteral">""</span>);
00114     int_name&lt;&lt;i;
00115     cgi_var(cgi, <span class="stringliteral">"int"</span>+int_name.str(), inter);
00116     <span class="keywordflow">if</span>( ! inter.empty() ) {
00117       <span class="keywordflow">for</span>( icur=ints.begin(); icur!=iend; ++icur ) {
00118         <span class="keywordflow">if</span>( icur-&gt;id == inter ) <span class="keywordflow">break</span>;
00119       }
00120       <span class="keywordflow">if</span>( icur != iend ) {
00121         ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo11">ints_id</a>.push_back(inter);
00122       }
00123     }
00124   }
00125 }
00126 
00129 <span class="keywordtype">bool</span> post_act() {
00130 <span class="preprocessor">#define ok_not(x) do { \</span>
00131 <span class="preprocessor">        *o&lt;&lt;x; \</span>
00132 <span class="preprocessor">        ok = false; \</span>
00133 <span class="preprocessor">} while(0)</span>
00134 <span class="preprocessor"></span>    <span class="keywordtype">bool</span> ok = <span class="keyword">true</span>;
00135     string::size_type len;
00136 
00137     *o&lt;&lt;<span class="stringliteral">"&lt;inv&gt;&lt;user "</span>;
00138     len = ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo1">login</a>.length();
00139     <span class="keywordflow">if</span>(len&lt;ac_user_minl.<a class="code" href="classcintconf.html#cintconfa2">val_int</a>()) ok_not(<span class="stringliteral">"sh=\"1\" "</span>);
00140     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(len&gt;ac_user_maxl.<a class="code" href="classcintconf.html#cintconfa2">val_int</a>()) ok_not(<span class="stringliteral">"lo=\"1\" "</span>);
00141     
00142     <span class="keywordflow">if</span>(htmlbad(ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo1">login</a>, ac_user_ok.<a class="code" href="classclnconf.html#clnconfa1">val_str</a>().c_str(), ac_html_br.<a class="code" href="classclnconf.html#clnconfa1">val_str</a>().at(0))) 
00143             ok_not(<span class="stringliteral">"dirty=\"1\" "</span>);
00144     *o&lt;&lt;<span class="stringliteral">"/&gt;"</span>;
00145     *o&lt;&lt;<span class="stringliteral">"&lt;pass "</span>;
00146     len = pass.length();
00147     <span class="keywordflow">if</span>(len&lt;ac_pass_minl.<a class="code" href="classcintconf.html#cintconfa2">val_int</a>()) ok_not(<span class="stringliteral">"sh=\"1\" "</span>);
00148     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(len&gt;ac_pass_maxl.<a class="code" href="classcintconf.html#cintconfa2">val_int</a>()) ok_not(<span class="stringliteral">"lo=\"1\" "</span>);
00149     <span class="keywordflow">if</span>(htmlbad(pass, ac_pass_ok.<a class="code" href="classclnconf.html#clnconfa1">val_str</a>().c_str(), ac_html_br.<a class="code" href="classclnconf.html#clnconfa1">val_str</a>().at(0)))
00150             ok_not(<span class="stringliteral">"dirty=\"1\" "</span>);
00151     <span class="keywordflow">if</span>( pass != pass1 ) ok_not(<span class="stringliteral">" nomatch=\"1\" "</span>);
00152     *o&lt;&lt;<span class="stringliteral">"/&gt;"</span>;
00153     <span class="comment">// country</span>
00154     *o&lt;&lt;<span class="stringliteral">"&lt;country "</span>;
00155     len = ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo3">country</a>.length();
00156     <span class="keywordflow">if</span>(len &lt;= ac_cntry_minl.<a class="code" href="classcintconf.html#cintconfa2">val_int</a>()) ok_not(<span class="stringliteral">"sh=\"1\" "</span>);
00157     *o&lt;&lt;<span class="stringliteral">"/&gt;"</span>;
00158     <span class="comment">// city</span>
00159     *o&lt;&lt;<span class="stringliteral">"&lt;city "</span>;
00160     len = ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo4">city</a>.length();
00161     <span class="keywordflow">if</span>(len &lt;= ac_city_minl.<a class="code" href="classcintconf.html#cintconfa2">val_int</a>()) ok_not(<span class="stringliteral">"sh=\"1\" "</span>);
00162     *o&lt;&lt;<span class="stringliteral">"/&gt;"</span>;
00163     <span class="comment">// birthday</span>
00164     *o&lt;&lt;<span class="stringliteral">"&lt;birthday "</span>;
00165     string t;
00166     <span class="keywordflow">if</span>( ! (t=date_valid(ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo5">birthday</a>)).empty() ) ok_not(<span class="stringliteral">"inv=\"1\" "</span>);
00167     *o&lt;&lt;<span class="stringliteral">"/&gt;"</span>;
00168     
00169     form2ints();
00170     *o&lt;&lt;<span class="stringliteral">"&lt;ints "</span>;
00171     <span class="keywordflow">if</span>( ! ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo11">ints_id</a>.size() ) ok_not(<span class="stringliteral">"no=\"1\" "</span>);
00172     *o&lt;&lt;<span class="stringliteral">"/&gt;"</span>;
00173     *o&lt;&lt;<span class="stringliteral">"&lt;/inv&gt;"</span>;
00174     
00175     <span class="keywordflow">if</span>( ok ) {
00176       auto_ptr&lt;cvq&gt; vq(cvq::alloc());
00177       <span class="keywordtype">int</span> ret;
00178 
00179       <a class="code" href="structcdbdaemon_1_1domain__info.html">cdbdaemon::domain_info</a> di;
00180       
00181       di.<a class="code" href="structcdbdaemon_1_1domain__info.html#cdbdaemon_1_1domain__infoo0">id</a> = ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo2">dom_id</a>;
00182       <span class="keywordflow">if</span>( db-&gt;<a class="code" href="classcdbdaemon.html#cdbdaemona9">domain_get</a>(di) == <a class="code" href="group__err.html#a1cdbdaemonw21">cdbdaemon::err_no</a> 
00183           &amp;&amp; db-&gt;<a class="code" href="classcdbdaemon.html#cdbdaemona11">ui_add</a>(ui) == <a class="code" href="group__err.html#a1cdbdaemonw21">cdbdaemon::err_no</a> ) {
00184         <span class="keywordflow">if</span>( (ret=vq-&gt;user_add(ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo1">login</a>, di.<a class="code" href="structcdbdaemon_1_1domain__info.html#cdbdaemon_1_1domain__infoo1">name</a>, pass)) ) {
00185           db-&gt;<a class="code" href="classcdbdaemon.html#cdbdaemona13">ui_rm</a>(ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo0">id</a>);
00186           *e&lt;&lt;me&lt;&lt;<span class="stringliteral">": vq-&gt;user_add: "</span>&lt;&lt;vq-&gt;err_report()&lt;&lt;endl;
00187         } <span class="keywordflow">else</span> {
00188           *o&lt;&lt;<span class="stringliteral">"&lt;add ok=\"\"&gt;"</span>;
00189           *o&lt;&lt;<span class="stringliteral">"&lt;domain&gt;"</span>&lt;&lt; di.<a class="code" href="structcdbdaemon_1_1domain__info.html#cdbdaemon_1_1domain__infoo1">name</a> &lt;&lt;<span class="stringliteral">"&lt;/domain&gt;"</span>;
00190           *o&lt;&lt;<span class="stringliteral">"&lt;user&gt;"</span> &lt;&lt; ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo1">login</a> &lt;&lt; <span class="stringliteral">"&lt;/user&gt;"</span>;
00191           *o&lt;&lt;<span class="stringliteral">"&lt;/add&gt;"</span>;
00192           <span class="keywordflow">if</span>(! ac_notify.<a class="code" href="classclnconf.html#clnconfa1">val_str</a>().empty()) notify_run();
00193           <span class="keywordflow">return</span> <span class="keyword">true</span>;
00194         }
00195       } <span class="keywordflow">else</span> {
00196         *e&lt;&lt;me&lt;&lt;<span class="stringliteral">": db-&gt;domain_get,ui_add: "</span>&lt;&lt; db-&gt;<a class="code" href="group__err.html#a2">err</a>() &lt;&lt; endl;
00197       }
00198       *o&lt;&lt;<span class="stringliteral">"&lt;add user_ex=\"\"/&gt;"</span>;
00199     }
00200     <span class="keywordflow">return</span> <span class="keyword">false</span>;
00201 <span class="preprocessor">#undef ok_not</span>
00202 <span class="preprocessor"></span>}
00203 
00204 <span class="keywordtype">void</span> ints2form() {
00205   vector&lt;cdbdaemon::int_info&gt;::const_iterator beg=ints.begin(), end=ints.end();
00206   vector&lt;string&gt;::const_iterator icur, iend = ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo11">ints_id</a>.end();
00207   *o&lt;&lt;<span class="stringliteral">"&lt;ints&gt;"</span>;
00208   <span class="keywordflow">for</span>( ; beg!=end; ++beg ) {
00209     *o&lt;&lt;<span class="stringliteral">"&lt;int id=\""</span> &lt;&lt; beg-&gt;id &lt;&lt;<span class="stringliteral">"\" name=\""</span> &lt;&lt; beg-&gt;name &lt;&lt;<span class="stringliteral">"\""</span>;
00210     <span class="keywordflow">for</span>( icur=ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo11">ints_id</a>.begin(); icur!=iend; ++icur ) {
00211       <span class="keywordflow">if</span>( *icur == beg-&gt;id ) { 
00212         *o&lt;&lt;<span class="stringliteral">" sel=\"1\" "</span>;
00213         <span class="keywordflow">break</span>;
00214       }
00215     }
00216     *o&lt;&lt;<span class="stringliteral">"/&gt;"</span>;
00217   }
00218   *o&lt;&lt;<span class="stringliteral">"&lt;/ints&gt;"</span>;
00219 }
00220 
00224 <span class="keywordtype">void</span> start( <span class="keywordtype">int</span> ac, <span class="keywordtype">char</span> **av, ostream &amp; o, ostream &amp; e, xslt_args_type &amp; ) {
00225     <span class="comment">// setup</span>
00226     me = *av;
00227     ::o = &amp;o;
00228     ::e = &amp;e;
00229    
00230     <span class="keywordflow">if</span>(!sig_chld_nocldwait()) <span class="keywordflow">throw</span> runtime_error(<span class="stringliteral">"can't setup signal handler for SIGCHLD"</span>);
00231     <span class="keywordflow">if</span>(!sig_pipeign()) <span class="keywordflow">throw</span> runtime_error(<span class="stringliteral">"can't setup signal handler for SIGPIPE"</span>);
00232             
00233     cgi = <span class="keyword">new</span> Cgicc();
00234     cgie = cgi-&gt;getElements().end();
00235     ce = &amp; cgi-&gt;getEnvironment();
00236     
00237     o&lt;&lt;<span class="stringliteral">"&lt;vqsignup&gt;"</span>;
00238  
00239     db = <a class="code" href="classcdbdaemon.html#cdbdaemone0">cdbdaemon::alloc</a>();
00240     
00241     <span class="comment">// get needed stuff from db</span>
00242     cgi_var(cgi, <span class="stringliteral">"locale"</span>, localeinfo);
00243     <span class="keywordflow">if</span>(localeinfo.empty()) localeinfo = <span class="stringliteral">"pl_PL"</span>;
00244     db-&gt;<a class="code" href="classcdbdaemon.html#cdbdaemona2">locale_set</a>(localeinfo);
00245     <span class="keywordflow">if</span>( db-&gt;<a class="code" href="classcdbdaemon.html#cdbdaemona3">edu_ls</a>(edu_levs) != <a class="code" href="group__err.html#a1cdbdaemonw21">cdbdaemon::err_no</a> 
00246         || db-&gt;<a class="code" href="classcdbdaemon.html#cdbdaemona4">work_ls</a>(works) != <a class="code" href="group__err.html#a1cdbdaemonw21">cdbdaemon::err_no</a>
00247         || db-&gt;<a class="code" href="classcdbdaemon.html#cdbdaemona5">int_ls</a>(ints) != <a class="code" href="group__err.html#a1cdbdaemonw21">cdbdaemon::err_no</a>
00248         || db-&gt;<a class="code" href="classcdbdaemon.html#cdbdaemona6">area_ls</a>(areas) != <a class="code" href="group__err.html#a1cdbdaemonw21">cdbdaemon::err_no</a>
00249         || db-&gt;<a class="code" href="classcdbdaemon.html#cdbdaemona7">sex_ls</a>(sexes) != <a class="code" href="group__err.html#a1cdbdaemonw21">cdbdaemon::err_no</a>
00250         || db-&gt;<a class="code" href="classcdbdaemon.html#cdbdaemona8">domain_ls</a>(domains) != <a class="code" href="group__err.html#a1cdbdaemonw21">cdbdaemon::err_no</a> ) {
00251       o &lt;&lt; <span class="stringliteral">"&lt;getcant/&gt;"</span>;
00252       <span class="keywordflow">goto</span> start_end;
00253     }
00254     <span class="keywordflow">if</span>( sexes.size() != 2 )
00255       <span class="keywordflow">throw</span> runtime_error(<span class="stringliteral">"sexes.size()!=2"</span>);
00256     
00257     <span class="comment">// real action</span>
00258     cgi_var(cgi, <span class="stringliteral">"user"</span>, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo1">login</a>); ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo1">login</a>=lower(ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo1">login</a>);
00259     cgi_var(cgi, <span class="stringliteral">"domain"</span>, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo2">dom_id</a> );
00260     cgi_var(cgi, <span class="stringliteral">"pass"</span>, pass);
00261     cgi_var(cgi, <span class="stringliteral">"pass1"</span>, pass1);
00262     cgi_var(cgi, <span class="stringliteral">"country"</span>, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo3">country</a>);
00263     cgi_var(cgi, <span class="stringliteral">"area"</span>, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo6">area_id</a>);
00264     cgi_var(cgi, <span class="stringliteral">"city"</span>, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo4">city</a>);
00265     cgi_var(cgi, <span class="stringliteral">"sex"</span>, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo9">sex_id</a>);
00266     cgi_var(cgi, <span class="stringliteral">"edu"</span>, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo8">edu_id</a>);
00267     cgi_var(cgi, <span class="stringliteral">"work"</span>, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo7">work_id</a>);
00268     cgi_var(cgi, <span class="stringliteral">"birthday"</span>, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo5">birthday</a>);
00269     cgi_var(cgi, <span class="stringliteral">"re_que"</span>, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo12">re_que</a>);
00270     cgi_var(cgi, <span class="stringliteral">"re_ans"</span>, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo13">re_ans</a>);
00271 <span class="preprocessor">#define spec_dec(x) x = html_spec_dec(x)</span>
00272 <span class="preprocessor"></span>    spec_dec(ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo3">country</a>);
00273     spec_dec(ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo4">city</a>);
00274     spec_dec(ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo5">birthday</a>);
00275     spec_dec(ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo12">re_que</a>);
00276     spec_dec(ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo13">re_ans</a>);
00277 <span class="preprocessor">#undef spec_dec</span>
00278 <span class="preprocessor"></span>
00279     <span class="keywordflow">if</span>( stringsAreEqual(ce-&gt;getRequestMethod(),<span class="stringliteral">"POST"</span>) ) {
00280             <span class="keywordflow">if</span>( post_act() ) <span class="keywordflow">goto</span> start_end;
00281     }
00282     o&lt;&lt;<span class="stringliteral">"&lt;edu&gt;"</span>;
00283     <span class="keywordflow">for</span>( vector&lt;cdbdaemon::edu_info&gt;::const_iterator beg = edu_levs.begin(), 
00284          end=edu_levs.end(); beg!=end; ++beg ) {
00285             o&lt;&lt;<span class="stringliteral">"&lt;lev id=\""</span> &lt;&lt; beg-&gt;id &lt;&lt;<span class="stringliteral">"\" name=\""</span> &lt;&lt; beg-&gt;name &lt;&lt;<span class="stringliteral">"\""</span>;
00286             <span class="keywordflow">if</span>( ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo8">edu_id</a> == beg-&gt;id ) o&lt;&lt;<span class="stringliteral">" sel=\"1\" "</span>;
00287             o&lt;&lt;<span class="stringliteral">"/&gt;"</span>;
00288     }
00289     o&lt;&lt;<span class="stringliteral">"&lt;/edu&gt;"</span>;
00290     o&lt;&lt;<span class="stringliteral">"&lt;works&gt;"</span>;
00291     <span class="keywordflow">for</span>( vector&lt;cdbdaemon::work_info&gt;::const_iterator beg = works.begin(), 
00292          end=works.end(); beg!=end; ++beg ) {
00293             o&lt;&lt;<span class="stringliteral">"&lt;work id=\""</span> &lt;&lt; beg-&gt;id &lt;&lt;<span class="stringliteral">"\" name=\""</span> &lt;&lt; beg-&gt;name &lt;&lt;<span class="stringliteral">"\""</span>;
00294             <span class="keywordflow">if</span>( ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo7">work_id</a> == beg-&gt;id ) o&lt;&lt;<span class="stringliteral">" sel=\"1\" "</span>;
00295             o&lt;&lt;<span class="stringliteral">"/&gt;"</span>;
00296     }
00297     o&lt;&lt;<span class="stringliteral">"&lt;/works&gt;"</span>;
00298     ints2form();
00299     o&lt;&lt;<span class="stringliteral">"&lt;areas&gt;"</span>;
00300     <span class="keywordflow">for</span>( vector&lt;cdbdaemon::area_info&gt;::const_iterator beg=areas.begin(),
00301          end=areas.end(); beg!=end; ++beg ) {
00302             o&lt;&lt;<span class="stringliteral">"&lt;area id=\""</span>&lt;&lt; beg-&gt;id &lt;&lt;<span class="stringliteral">"\" name=\""</span>&lt;&lt; beg-&gt;name &lt;&lt;<span class="stringliteral">"\""</span>;
00303             <span class="keywordflow">if</span>( ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo6">area_id</a> == beg-&gt;id ) o&lt;&lt;<span class="stringliteral">" sel=\"1\" "</span>;
00304             o&lt;&lt;<span class="stringliteral">"/&gt;"</span>;
00305     }
00306     o&lt;&lt;<span class="stringliteral">"&lt;/areas&gt;"</span>;
00307     o&lt;&lt;<span class="stringliteral">"&lt;sexes&gt;"</span>;
00308     <span class="keywordflow">for</span>( vector&lt;cdbdaemon::sex_info&gt;::const_iterator beg=sexes.begin(),
00309          end=sexes.end(); beg!=end; ++beg ) {
00310             o&lt;&lt;<span class="stringliteral">"&lt;sex id=\""</span> &lt;&lt; beg-&gt;id &lt;&lt;<span class="stringliteral">"\" name=\""</span>&lt;&lt; beg-&gt;name &lt;&lt;<span class="stringliteral">"\""</span>;
00311             <span class="keywordflow">if</span>( ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo9">sex_id</a> == beg-&gt;id ) o&lt;&lt;<span class="stringliteral">" sel=\"1\" "</span>;
00312             o&lt;&lt;<span class="stringliteral">"/&gt;"</span>;
00313     }
00314     o&lt;&lt;<span class="stringliteral">"&lt;/sexes&gt;"</span>;
00315     o&lt;&lt;<span class="stringliteral">"&lt;domains&gt;"</span>;
00316     <span class="keywordflow">for</span>( vector&lt;cdbdaemon::domain_info&gt;::const_iterator beg=domains.begin(),
00317          end=domains.end(); beg!=end; ++beg ) {
00318             o&lt;&lt;<span class="stringliteral">"&lt;domain id=\""</span> &lt;&lt; beg-&gt;id &lt;&lt;<span class="stringliteral">"\" name=\""</span> &lt;&lt; beg-&gt;name &lt;&lt; <span class="stringliteral">"\""</span>;
00319             <span class="keywordflow">if</span>( ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo2">dom_id</a>==beg-&gt;id ) o&lt;&lt;<span class="stringliteral">" sel=\"1\" "</span>;
00320             o&lt;&lt;<span class="stringliteral">"/&gt;"</span>;
00321     }
00322     o&lt;&lt;<span class="stringliteral">"&lt;/domains&gt;"</span>;
00323     o&lt;&lt;<span class="stringliteral">"&lt;user val=\""</span> &lt;&lt; ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo1">login</a> &lt;&lt; <span class="stringliteral">"\" allowed=\""</span> &lt;&lt; ac_user_ok.<a class="code" href="classclnconf.html#clnconfa1">val_str</a>();
00324     o&lt;&lt; <span class="stringliteral">"\" minl=\""</span>&lt;&lt;ac_user_minl.<a class="code" href="classcintconf.html#cuidconfa2">val_str</a>()&lt;&lt;<span class="stringliteral">"\" maxl=\""</span>&lt;&lt;ac_user_maxl.<a class="code" href="classcintconf.html#cuidconfa2">val_str</a>()&lt;&lt;<span class="stringliteral">"\"/&gt;"</span>;
00325     o&lt;&lt;<span class="stringliteral">"&lt;pass val=\""</span> &lt;&lt; pass &lt;&lt; <span class="stringliteral">"\" allowed=\""</span> &lt;&lt; ac_pass_ok.<a class="code" href="classclnconf.html#clnconfa1">val_str</a>()
00326      &lt;&lt; <span class="stringliteral">"\" minl=\""</span>&lt;&lt;ac_pass_minl.<a class="code" href="classcintconf.html#cuidconfa2">val_str</a>()&lt;&lt;<span class="stringliteral">"\" maxl=\""</span>&lt;&lt;ac_pass_maxl.<a class="code" href="classcintconf.html#cuidconfa2">val_str</a>()&lt;&lt;<span class="stringliteral">"\"/&gt;"</span>;
00327     o&lt;&lt;<span class="stringliteral">"&lt;pass1 val=\""</span> &lt;&lt; pass1 &lt;&lt; <span class="stringliteral">"\"/&gt;"</span>;
00328  
00329     o&lt;&lt;<span class="stringliteral">"&lt;country val=\""</span> &lt;&lt; html_spec_enc(ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo3">country</a>) &lt;&lt; <span class="stringliteral">"\" minl=\""</span>&lt;&lt; ac_cntry_minl.<a class="code" href="classcintconf.html#cuidconfa2">val_str</a>()&lt;&lt;<span class="stringliteral">"\"/&gt;"</span>;
00330     o&lt;&lt;<span class="stringliteral">"&lt;city val=\""</span> &lt;&lt; html_spec_enc(ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo4">city</a>) &lt;&lt; <span class="stringliteral">"\" minl=\""</span>&lt;&lt; ac_city_minl.<a class="code" href="classcintconf.html#cuidconfa2">val_str</a>() &lt;&lt;<span class="stringliteral">"\"/&gt;"</span>;
00331 
00332 <span class="preprocessor">#define spec_enc(x) o&lt;&lt;"&lt;" #x " val=\"" &lt;&lt; html_spec_enc(ui.x) &lt;&lt; "\"/&gt;"</span>
00333 <span class="preprocessor"></span>    spec_enc(birthday);
00334     spec_enc(re_que);
00335     spec_enc(re_ans);
00336 <span class="preprocessor">#undef spec_enc</span>
00337 <span class="preprocessor"></span>
00338 start_end:
00339     o&lt;&lt;<span class="stringliteral">"&lt;/vqsignup&gt;"</span>;
00340 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu Dec 25 13:37:19 2003 for vqwww: freemail by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.3 </small></address>
</body>
</html>
