<?xml version="1.0" encoding="iso-8859-2"?>
<chapter id="install">
	<title>Instalacja</title>

	<para>
		Krok po kroku, czyli przepis na instalacjê.
	</para>
	
	<section id="install.download">
		<title>¦ci±ganie</title>

		<para>
			Warto rozpocz±æ od sprawdzenia 
			<ulink url="http://v-q.foo-baz.com">strony projektu</ulink>.
		</para>

		<para>
			<ulink url="http://sf.net/project/showfiles.php?group_id=87916">Udostêpnione pliki</ulink>
			przechowywane s± na serwerze SourceForge. Sprawd¼ czy nie ma
			nowych wersji.
		</para>
	</section>

	<section id="install.deps">
		<title>Zale¿no¶ci</title>

		<para>
			To jest z³o¿ony system, który zale¿y od innych projektów.
		</para>

		<para>
			G³ówne zale¿no¶ci:

			<itemizedlist>
				<listitem>
					<para>
						nowoczesny kompilator C++, je¿eli u¿ywasz gcc
						to powinien on byæ w wersji >= 3.
					</para>
				</listitem>
				<listitem>
					<para>
						implementacja protoko³u CORBA posiadaj±ca obs³ugê C++, 
						przyk³adowo: <ulink url="http://www.mico.org">MICO</ulink> 
						lub <ulink url="http://www.omniorb.org">omniORB</ulink>
					</para>
				</listitem>
				<listitem>
					<para>kompatybilny agent transferu poczty</para>
				</listitem>
				<listitem>
					<para>biblioteka <ulink url="http://www.boost.org">boost</ulink></para>
				</listitem>
				<listitem>
					<para>DocBook i doxygen je¿eli chcesz generowaæ now± wersjê dokumentacji</para>
				</listitem>
				<listitem>
					<para>obs³ugiwane biblioteki dostêpu do bazy danych</para>
				</listitem>
				<listitem>
					<para>bibliotek Cgicc je¿eli chcesz generowaæ interfejs WWW</para>
				</listitem>
				<listitem>
					<para>Iconv je¿eli chcesz generowaæ interfejs WWW</para>
				</listitem>
				<listitem>
					<para>Sablotron je¿eli chcesz generowaæ interfejs WWW. 
						Przynajmniej w wersji 1.0.</para>
				</listitem>
			</itemizedlist>
		</para>

		<section id="install.mta">
			<title>Agent transferu poczty (MTA)</title>

			<para>
				Na dzieñ dzisiejszy tylko <application>qmail</application> 
				jest obs³ugiwany. Musisz go zainstalowaæ przed kompilacj±.
			</para>

			<para>
				Sugerowane jest u¿ycie <application>qmail</application>
				wraz z zestawem ³atek <ulink url="http://q-p.foo-baz.com">Qmail-patches</ulink>.
				Jednak¿e nie jest to wymagane, mo¿esz u¿ywaæ dowoln± wersjê
				<application>qmail</application>.
			</para>

			<para>
				Z czasem inne programy MTA powinny byæ obs³ugiwane.
			</para>
		</section>

		<section id="install.pgsql">
			<title>U¿ywanie PostgreSQL</title>

			<para>
				Musisz ¶ci±gn±æ i zainstalowaæ <application>PostgreSQL</application>.
				Zalecane jest korzystanie z najnowszej stabilnej wersji.
				Potrzebujesz równie¿ bibliotekê 
				libpqxx w wersji co najmniej 2.4.2 oraz PERL i modu³
				zwany DBI::Pg (tylko je¿eli chcesz korzystaæ ze skryptu
				instalacyjnego). Wszystkie programy mo¿esz ¶ci±gn±æ z
				<ulink url="http://www.postgresql.org">http://www.postgresql.org</ulink>.
			</para>
		</section>

		<section id="install.oracle">
			<title>U¿ywanie Oracle</title>

			<para>
				Od wersji 7pre1 <application>Oracle</application> jest oficjalnie
				obs³ugiwan± baz± danych. Na dzieñ dzisiejszy mo¿na
				korzystaæ z tej bazy danych tylko za pomoc± demonów
				JDBC. Nale¿y posiadaæ sterowniki JDBC dla posiadanej
				wersji Oracle, nie s± one do³±czone do pakietu. 
				Domy¶lne skrypty SQL znajduj± siê w katalogu
				<filename>base/oracle</filename>.
				Oracle 10g zosta³ przetestowany przy wykorzystaniu
				<filename>ojdbc14.jar</filename>, jednak¿e v-q 
				powinien dzia³aæ bez problemów ze starszymi wersjami.
			</para>
		</section>
 
		<section id="install.otherdb">
			<title>Inne systemy bazodanowe</title>

			<para>
				Poni¿ej przedstawiona jest lista baz danych, które
				nie s± kompatybilne z v-q:
				<itemizedlist>
					<listitem>
						<para>MySQL - brak obs³ugi widoków, procedur przechowywanych po stronie klienta;</para>
					</listitem>
					<listitem>
						<para>
							Firebird - nie mo¿na utworzyæ indeksu z kluczem
							wiêkszym ni¿ 252 bajty. Powinno to zostaæ
							naprawione w wersji 2, jednak¿e jak na razie
							dalej to nie dzia³a (sprawdzona wersja 2.0 Alpha 2),
							inne potrzebne funkcje s± dostêpne;
						</para>
					</listitem>
					<listitem>
						<para>
							Cloudscape (AKA apache-derby) - nie mo¿na
							utworzyæ perspektywy zawieraj±cej
							funkcjê agreguj±c±, pozosta³e wymagane
							funkcje s± dostêpne;
						</para>
					</listitem>
				</itemizedlist>
			</para>
		</section>
 	</section>
 
	<section id="install.prep">
		<title>Przygotowania</title>

		<para>
			Zainstaluj oprogramowanie wymienione w
			<xref linkend="install.download"/> i <xref linkend="install.deps"/>.
		</para>

		<section>
			<title>Tworzenie u¿ytkownika i grupy</title>

			<para>
			Demony v-q mog± pracowaæ jako dowolny u¿ytkownik, sugeruje siê
			aby pracowa³y jako u¿ytkownik _vq w grupie _vq.
				<warning>
					<para>
						Ze wzglêdów bezpieczeñstwa nie powinny byæ
						uruchamiane jako root. Lepiej zapobiegaæ ni¿ leczyæ.
					</para>
				</warning>
			</para>

			<para>
			Mo¿esz u¿yæ poni¿szych poleceñ aby utworzyæ wspomniane konto
			(dzia³a na pewno pod Linux i OpenBSD):
<synopsis>groupadd _vq
useradd -g _vq -d /var/vq _vq</synopsis>
			</para>
		</section>

		<section id="install.unpack">
			<title>Rozpakowywanie ¼róde³</title>

			<para>
				Zale¿nie od wybranego formatu archiwum bêdziesz potrzebowa³
				programy <application>tar</application>,
				<application>bzip2</application> lub <application>gzip</application>.
			</para>

			<para>
				Je¿eli nazwa archiwum koñczy siê na <filename>.tar.gz</filename>
				mo¿esz rozpakowaæ je nastêpuj±cym poleceniem:
<synopsis>
tar -xzvf v-q.*.tar.gz
</synopsis>
				Ewentualnie (je¿eli tar nie posiada wbudowanej obs³ugi gzip):
<synopsis>
gzip -dc v-q.*.tar.gz | tar -xvf -
</synopsis>
			</para>

			<para>
				Je¿eli nazwa archiwum koñczy siê na <filename>.tar.bz2</filename>
				mo¿esz rozpakowaæ je nastêpuj±cym poleceniem:
<synopsis>
bzip2 -cd v-q.*.tar.bz2 | tar -xvf -
</synopsis>
			</para>

			<para>
				Na dzieñ dzisiejszy ¼ród³a rozprowadzane s± tylko w wymienionych
				formatach.
		
				<note>
					<para>
						<application>Bzip2</application> oferuje lepszy
						stopieñ kompresji w porównaniu z <application>gzip</application>
						jednak¿e nie jest tak popularny. Je¿eli
						posiadasz w systemie <application>bzip2</application>
						sugerowane jest u¿ycie tego formatu.
					</para>
				</note>
			</para>
		</section>

		<section id="install.conf">
			<title>Konfiguracja przed instalacj±</title>

			<para>
				Przed uruchomieniem <application>make</application>
				musisz odpowiednio skonfigurowaæ ¼ród³a. Nie ma
				skryptu <application>configure</application>. V-q
				nie korzysta z <application>autoconf</application> i 
				jego rodziny.
			</para>

			<para>
				Nie masz powodów do obaw. Konfiguracja jest stosunkowo
				³atwa - wystarczy zaktualizowaæ kilka plików.
			</para>

			<para>
				Na pocz±tku musisz ustaliæ kompilator i jego opcje.
				W g³ównym katalogu nale¿y zaktualizowaæ nastêpuj±ce pliki:
				<itemizedlist>
					<listitem><para>
						<filename>compile</filename> u¿ywany jest do
						normalnej kompilacji.
						Domy¶lnie wywo³ywane jest <application>g++</application>.
					</para></listitem>
					<listitem><para>
						<filename>comp-so</filename> u¿ywany jest do
						kompilacji plików, które wejd± w sk³ad archiwum
						dzielonego (biblioteki).
						Domy¶lnie wywo³ywane jest <application>g++</application>
						z argumentami: -fpic -DPIC.
					</para></listitem>
					<listitem><para>
						<filename>load</filename> u¿ywany jest do tworzenia
						programów. Domy¶lnie wywo³ywane jest
						<application>g++</application>.
					</para></listitem>
					<listitem><para>
						<filename>make-lib</filename> u¿ywany jest do tworzenia
						statycznie linkowany bibliotek. Wywo³uje
						<application>ar</application>.
					</para></listitem>
					<listitem><para>
						<filename>make-so</filename> u¿ywany jest do
						tworzenia bibliotek dzielonych dynamicznie.
						Wywo³uje <application>g++</application> z opcj± -shared.
					</para></listitem>
					<listitem><para>
						<filename>idl</filename> u¿ywany jest do
						t³umaczenia plików IDL na pliki C++.
						Pamiêtaj, ¿e skrypt ten powinien tworzyæ
						2 pliki z rozszerzeniami: .hpp i .cc.
						Domy¶lnie wywo³ywany jest <application>idl</application>
						(<ulink url="http://www.mico.org">MICO</ulink>)
						lub omniidl (<ulink url="http://www.omniorb.org">omniORB</ulink>).
					</para></listitem>
				</itemizedlist>
			</para>

			<para>
				Je¿eli u¿ywasz innych programów ni¿ te wymienione
				proszê wy¶lij opis wywo³ania do 
				<link linkend="pniewiadomski">Paw³a Niewiadomskiego</link>
			</para>

			<para>
				Nastêpny krokiem jest aktualizacja plików z
				rozszerzeniami: <filename>.inc</filename> i <filename>.lib</filename>.
				Pierwszy typ plików u¿ywany jest podczas kompilacji, zawieraj±
				one opcje dla kompilatora. Drugi typ plików
				u¿ywany jest podczas linkowania, zawieraj± one informacje
				o bibliotekach, które maj± zostaæ u¿yte.
			</para>

			<section id="install.corba.conf">
				<title>Okre¶lanie u¿ywanej implementacji CORBA</title>

				<para>
					Przed kompilacj± musisz okre¶liæ, któr± z dostêpnych
					i obs³ugiwanych implementacji CORBA chcesz u¿yæ.
					W tym celu musisz zaktualizowaæ 3 pliki.
				</para>

				<para>
					<filename>corba.lib</filename> powinien zawieraæ
					wszystkie argumenty dla <application>make-so</application>,
					które u¿ywane bêd± w czasie linkowania.
					Powiniene¶ tam umie¶ciæ odwo³ania do wszystkich
					bibliotek wymaganych przez wybran± implementacjê
					CORBA.
				</para>

				<para>
					<filename>corba.inc</filename> powinien zawieraæ
					argumenty przekazywane do <application>comp-so</application>
					i <application>compile</application>, które
					wska¿± katalogi z plikami nag³ówkowymi wymaganymi
					przez wybran± implementacjê CORBA. Niezbêdny jest
					równie¿ argument okre¶laj±cy, która implementacja
					CORBA powinna byæ u¿yta.
					Przyk³adowo je¿eli chcesz u¿ywaæ MICO musisz podaæ -DP_USE_MICO.
					Oznacza to, ¿e w czasie kompilacja definicja P_USE_MICO 
					bêdzie zdefiniowana.
					Inne mo¿liwo¶ci:
					<itemizedlist>
						<listitem><para>P_USE_MICO - dla MICO</para></listitem>
						<listitem><para>P_USE_OMNIORB - dla omniORB</para></listitem>
						<listitem><para>P_USE_ORBACUS - dla Orbacus</para></listitem>
						<listitem><para>P_USE_TAO - dla TAO</para></listitem>
						<listitem><para>P_USE_ORBIX - dla Orbix</para></listitem>
					</itemizedlist>

					<note>
						<para>
							Na razie oprogramowanie zosta³o przetestowane
							z MICO (bez obs³ugi w±tków) i omniORB.
						</para>
					</note>
				</para>

				<para>
					Nale¿y równie¿ okre¶liæ program, który bêdzie
					u¿ywany do translacji plików IDL - w tym
					celu nale¿y zmieniæ plik <filename>idl</filename>.
					Plik zawiera przyk³ady dla obs³ugiwanych implementacji
					CORBA.
				</para>
<example>
	<title>corba.inc dla MICO zainstalowanego w /usr/local/progs/mico</title>
<screen><userinput>
-DP_USE_MICO -I/usr/local/progs/mico/include
</userinput></screen>
</example>

<example>
	<title>corba.lib dla MICO zainstalowanego w /usr/local/progs/mico</title>
<screen><userinput>
-L/usr/local/progs/mico/lib -lmicocoss2.3.11 -lmico2.3.11 -lssl -lcrypto
</userinput></screen>
</example>

<example>
	<title>corba.inc dla omniORB zainstalowanego w /usr/local/progs/omniorb</title>
<screen><userinput>
-DP_USE_OMNIORB -I/usr/local/progs/omniorb/include
</userinput></screen>
</example>

<example>
	<title>corba.lib dla omniORB zainstalowanego w /usr/local/progs/omniorb</title>
<screen><userinput>
-L/usr/local/progs/omniorb/lib -lCOS4 -lCOSDynamic4 -lomniORB4 -lssl -lcrypto -lpthread 
</userinput></screen>
</example>
			</section>
		</section>
	</section>

	<section id="install.comp">
		<title>Kompilacja</title>
		
		<para>Najwy¿szy czas aby skompilowaæ ¼ród³a. Je¿eli skonfigurowa³e¶
		wszystko poprawnie powiniene¶ bez problemów skompilowaæ
		Virtual Qmail.</para>

		<para>
			Aby rozpocz±æ kompilacjê skorzystaj z <application>make</application>.
			Obie wersje programu s± obs³ugiwane: BSD lub GNU. 
			Zale¿nie od pow³oki u¿ywanej przez Ciebie, dla 
			<application>sh</application> napisz:
<screen>
<userinput>
make 2>&amp;1 > out
</userinput>
</screen>
			Dla tcsh napisz:
<screen>
<userinput>
make >&amp; out
</userinput>
</screen>
			Po tym jak <application>make</application> zakoñczy dzia³anie
			sprawd¼ plik <filename>out</filename> aby sprawdziæ przebieg
			kompilacji.
		</para>

		<para>
			Je¿eli nie jeste¶ w stanie skompilowaæ v-q wy¶lij
			<filename>out</filename> do 
			<link linkend="pniewiadomski">Paw³a Niewiadomskiego</link>.
		</para>

		<para>
			Wykonanie <application>make</application> bez argumentów
			generuje tylko podstawow± czê¶æ systemu, bez obs³ugi
			baz danych czy interfejsu WWW.
			Makefile zawiera nastêpuj±ce cele:
			<itemizedlist>
				<listitem><para>pgsql - generacja modu³ów korzystaj±cych z PostgreSQL</para></listitem>
				<listitem><para>clean - usuwanie obiektów utworzonych w czasie kompilacji</para></listitem>
<!--				<listitem><para></para></listitem>
				<listitem><para></para></listitem>-->
			</itemizedlist>
		</para>
	</section>

	<section id="install.install">
		<title>Instalacja</title>

		<para>
			Po prawid³owej kompilacji jeste¶ w stanie zainstalowaæ oprogramowanie.
			Jest to tak proste jak napisanie:
<screen>
<userinput>
make install
</userinput>
</screen>
			Mo¿esz dodaæ równie¿ argument PREFIX=jaki¶/katalog
			aby zainstalowaæ v-q w innym ni¿ domy¶lny katalogu.
			Poni¿sze polecenie zainstaluje wszystkie pliki w
			<filename>/var/v-q</filename>:
<screen>
<userinput>
make PREFIX=/var/v-q install
</userinput>
</screen>
			<note>
				<para>
					Domy¶lnym katalogiem instalacji jest <!--ENV:PREFIX-->/var/vq<!--/ENV:PREFIX-->.
				</para>
			</note>
		</para>

		<section id="install.steps.qmail">
			<title>Specjalne kroki dla Qmail</title>
		
			<para>
				Po instalacji v-q mo¿esz dopasowaæ kilka ustawieñ.
				Dla przyk³adu je¿eli w³a¶cicielem konfiguracji qmail
				jest inny u¿ytkownik ni¿ ten, jako który
				dzia³a <application>qmailvqd</application>
				mo¿esz zmieniæ w³a¶ciciela i ustawiæ bit SETUID 
				programom <filename>bin/qmail*</filename> (oprócz 
				<application>qmailvqd</application>). Dziêki temu bêd±
				one w stanie modyfikowaæ konfiguracjê qmail.
				<note>
					<para>
						Programy zaczynaj±ce siê od <filename>qmail_</filename>
						s± zwyk³ymi skryptami pow³oki - w ich przypadku
						nadanie prawa SETUID/SETGID nie zadzia³a. Musisz je zmieniæ tak
						aby wykorzystywa³y <application>sudo</application>
						do uruchamiania poleceñ. Zobacz zawarto¶æ pliku
						<application>qmail-send-restart</application>
						je¿eli chcesz wiedzieæ wiêcej.
					</para>
				</note>
			</para>
		</section>

		<section id="install.steps.pgsql">
			<title>Specjalne kroki dla PostgreSQL</title>

			<para>
				Musisz utworzyæ u¿ytkownika w systemie PostgreSQL. Domy¶lnie
				jest to u¿ytkownik &quot;mail&quot;, mo¿esz u¿yæ innej nazwy. 
				Aby utworzyæ domy¶lnego u¿ytkownika uruchom polecenie:
<screen>
<userinput>
createuser -A -D -P mail
</userinput>
</screen>
			</para>

			<para>
				Teraz musisz utworzyæ bazê danych dla v-q. Domy¶lnie
				nazywa siê ona &quot;mail&quot;, mo¿esz u¿yæ innej nazwy.
<screen>
<userinput>
createdb -E utf-8 -O mail mail
</userinput>
</screen>
			</para>

			<para>
				Aby skompilowaæ modu³y korzystaj±ce z PostgreSQL
				uruchom polecenie w sh:
<screen>
<userinput>
make pgsql 2>&amp;1 > out.pgsql
</userinput>
</screen>
				W tcsh u¿yj polecenia:
<screen>
<userinput>
make pgsql >&amp; out.pgsql
</userinput>
</screen>
				Pamiêtaj, ¿e program pqxx-config musi byæ 
				w ¶cie¿ce poszukiwañ (je¿eli nie masz takiego programu
				oznacza to, ¿e nie masz libpqxx lub jest to stara, 
				nieobs³ugiwana wersja).
			</para>

			<para>
				Aby zainstalowaæ modu³y PostgreSQL:
<screen>
<userinput>
make install-pgsql
</userinput>
</screen>
				Mo¿esz dodaæ równie¿ argument PREFIX=jaki¶/katalog
				aby zainstalowaæ v-q w innym ni¿ domy¶lny katalogu.
				Poni¿sze polecenie zainstaluje wszystkie pliki w
				<filename>/var/v-q</filename>:
<screen>
<userinput>
make PREFIX=/var/v-q install
</userinput>
</screen>
				<note>
					<para>
						Domy¶lnym katalogiem instalacji jest <!--ENV:PREFIX-->/var/vq<!--/ENV:PREFIX-->.
					</para>
				</note>
			</para>

			<para>
				Chc±c utworzyæ obiekty w bazie danych mo¿esz pos³u¿yæ
				siê skryptem PERL <application>install.pgsql</application>. 
				Dokument nie opisuje w jaki sposób rêcznie utworzyæ
				odpowiednie obiekty. Niezbêdne informacje mo¿na wyczytaæ
				z wymienionego skryptu.

				<note>
					<para>
						Przed uruchomieniem skryptu sprawd¼ czy odpowiada
						Twoim potrzebom (np. czy zgadza siê nazwa 
						przestrzeni tabel).
					</para>
				</note>

				<caution>
					<para>
						Pamiêtaj aby ustawiæ has³o dla u¿ytkownika 
						bazy danych i skonfigurowaæ PostgreSQL
						aby wymaga³ autoryzacji.
						Je¿eli nie zrobisz tego ka¿dy u¿ytkownik bêdzie
						móg³ modyfikowaæ dane znajduj±ce siê w bazie.
					</para>
				</caution>
			</para>
		</section>

		<section id="install.problems">
			<title>Mam problem, co zrobiæ?</title>

			<para>
				Je¿eli nie mo¿esz zainstalowaæ v-q sprawd¼
				<ulink url="http://v-q.foo-baz.com">stronê projektu</ulink>,
				sprawd¼ równie¿
				<ulink url="http://sf.net/projects/v-q">stronê projektu na SourceForge</ulink>.
				Znajdziesz tam listê dyskusyjn±, forum, etc.
			</para>

			<para>
				Przeczytaj równie¿ <xref linkend="community"/>
			</para>
		</section>
	</section>
</chapter>

