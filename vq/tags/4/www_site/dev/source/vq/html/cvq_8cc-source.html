<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Virtual Qmail: cvq.cc Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.3 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Compound&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Compound&nbsp;Members</a></div>
<h1>cvq.cc</h1><div class="fragment"><pre>00001 <span class="preprocessor">#include &lt;sstream&gt;</span>
00002 <span class="preprocessor">#include &lt;cerrno&gt;</span>
00003 
00004 <span class="preprocessor">#include "cvq.h"</span>
00005 
00006 <span class="keyword">using</span> <span class="keyword">namespace </span>std;
00007 
00008 cvq::logic_error::logic_error( <span class="keyword">const</span> std::string &amp;w, <span class="keyword">const</span> std::string &amp;f,
00009         <span class="keywordtype">int</span> l) {
00010     ostringstream os;
00011     os&lt;&lt;f&lt;&lt;<span class="charliteral">'@'</span>&lt;&lt;l&lt;&lt;<span class="charliteral">':'</span>&lt;&lt;w;
00012     _what = os.str();
00013 }
00014 
00015 <span class="keyword">const</span> <span class="keywordtype">char</span> * cvq::logic_error::what() <span class="keyword">const</span> <span class="keywordflow">throw</span>() {
00016     <span class="keywordflow">return</span> _what.c_str();
00017 }
00018 
00019 cvq::runtime_error::runtime_error( <span class="keyword">const</span> std::string &amp;w, <span class="keyword">const</span> std::string &amp;f,
00020         <span class="keywordtype">int</span> l) {
00021     ostringstream os;
00022     os&lt;&lt;f&lt;&lt;<span class="charliteral">'@'</span>&lt;&lt;l&lt;&lt;<span class="charliteral">':'</span>&lt;&lt;w;
00023     _what = os.str();
00024 }
00025 
00026 <span class="keyword">const</span> <span class="keywordtype">char</span> * cvq::runtime_error::what() <span class="keyword">const</span> <span class="keywordflow">throw</span>() {
00027     <span class="keywordflow">return</span> _what.c_str();
00028 }
00029 
00033 cvq::cvq() : <a class="code" href="group__err.html#a7">lr_errno</a>(0), <a class="code" href="group__err.html#a8">lastret</a>(<a class="code" href="group__err.html#a16cvqw2">err_no</a>), <a class="code" href="group__err.html#a9">lastret_blkd</a>(false) {
00034 }
00035 
<a name="l00040"></a><a class="code" href="classcvq.html#a19">00040</a> uint8_t <a class="code" href="group__dom.html#a19">cvq::dom_val</a>(<span class="keyword">const</span> string &amp; d)
00041 {
00042     <span class="keyword">const</span> <span class="keywordtype">char</span> *ptr = d.c_str();
00043     <span class="keywordflow">if</span>( d.empty() ) <span class="keywordflow">return</span> 0;
00044     <span class="keywordflow">for</span>( ; *ptr; ptr++ ) {
00045             <span class="keywordflow">if</span>( ! ( ( *ptr &gt;= <span class="charliteral">'A'</span> &amp;&amp; *ptr &lt;= <span class="charliteral">'Z'</span> )
00046                 || ( *ptr &gt;= <span class="charliteral">'a'</span> &amp;&amp; *ptr &lt;= <span class="charliteral">'z'</span> )
00047                 || ( *ptr &gt;= <span class="charliteral">'0'</span> &amp;&amp; *ptr &lt;=<span class="charliteral">'9'</span> )
00048                 || *ptr == <span class="charliteral">'.'</span> || *ptr == <span class="charliteral">'-'</span> ) )
00049                     <span class="keywordflow">return</span> 0;
00050     }
00051     <span class="keywordflow">return</span> 1;
00052 }
00053 
<a name="l00057"></a><a class="code" href="classcvq.html#a10">00057</a> uint8_t <a class="code" href="group__user.html#a10">cvq::user_val</a>(<span class="keyword">const</span> string &amp;u)
00058 {
00059     <span class="keywordflow">if</span>( u.empty() ) <span class="keywordflow">return</span> 0;
00060     <span class="keyword">const</span> <span class="keywordtype">char</span> *ptr = u.c_str();
00061     <span class="keywordflow">for</span>( ; *ptr; ptr++ ) {
00062             <span class="keywordflow">if</span>( (*ptr &gt;= <span class="charliteral">'a'</span> &amp;&amp; *ptr &lt;= <span class="charliteral">'z'</span>)
00063                 || (*ptr &gt;= <span class="charliteral">'A'</span> &amp;&amp; *ptr &lt;= <span class="charliteral">'Z'</span> )
00064                 || (*ptr &gt;= <span class="charliteral">'0'</span> &amp;&amp; *ptr &lt;= <span class="charliteral">'9'</span> ) )
00065                     <span class="keywordflow">continue</span>;
00066 
00067             <span class="keywordflow">switch</span>(*ptr) {
00068             <span class="keywordflow">case</span> <span class="charliteral">'$'</span>: <span class="keywordflow">case</span> <span class="charliteral">'%'</span>: <span class="keywordflow">case</span> <span class="charliteral">'&amp;'</span>: <span class="keywordflow">case</span> <span class="charliteral">'\''</span>:
00069             <span class="keywordflow">case</span> <span class="charliteral">'*'</span>: <span class="keywordflow">case</span> <span class="charliteral">'+'</span>: <span class="keywordflow">case</span> <span class="charliteral">'-'</span>: <span class="keywordflow">case</span> <span class="charliteral">'/'</span>:
00070             <span class="keywordflow">case</span> <span class="charliteral">'='</span>: <span class="keywordflow">case</span> <span class="charliteral">'?'</span>: <span class="keywordflow">case</span> <span class="charliteral">'^'</span>: <span class="keywordflow">case</span> <span class="charliteral">'_'</span>:
00071             <span class="keywordflow">case</span> <span class="charliteral">'`'</span>: <span class="keywordflow">case</span> <span class="charliteral">'{'</span>: <span class="keywordflow">case</span> <span class="charliteral">'|'</span>: <span class="keywordflow">case</span> <span class="charliteral">'}'</span>:
00072             <span class="keywordflow">case</span> <span class="charliteral">'~'</span>: <span class="keywordflow">case</span> <span class="charliteral">'.'</span>: <span class="keywordflow">case</span> <span class="charliteral">'!'</span>: <span class="keywordflow">case</span> <span class="charliteral">'#'</span>:
00073                     <span class="keywordflow">continue</span>;
00074             <span class="keywordflow">default</span>: 
00075                     <span class="keywordflow">return</span> 0;
00076             }
00077     }
00078     <span class="keywordflow">return</span> 1;
00079 }
00080 
<a name="l00084"></a><a class="code" href="classcvq.html#a22">00084</a> string <a class="code" href="group__dom.html#a21">cvq::err_str</a>( uint8_t e ) {
00085     <span class="keywordflow">return</span> <a class="code" href="group__dom.html#a21">err_str</a>( static_cast&lt;error&gt;(e) );
00086 }
00087 
<a name="l00091"></a><a class="code" href="classcvq.html#a21">00091</a> string <a class="code" href="group__dom.html#a21">cvq::err_str</a>( error e ) {
00092     <span class="keywordflow">switch</span>(e) {
00093     <span class="keywordflow">case</span> <a class="code" href="group__err.html#a16cvqw2">err_no</a>:
00094             <span class="keywordflow">return</span> <span class="stringliteral">"Success"</span>;
00095     <span class="keywordflow">case</span> <a class="code" href="group__err.html#a16cvqw3">err_temp</a>:
00096             <span class="keywordflow">return</span> <span class="stringliteral">"Temporary error"</span>;
00097     <span class="keywordflow">case</span> <a class="code" href="group__err.html#a16cvqw4">err_dom_inv</a>:
00098             <span class="keywordflow">return</span> <span class="stringliteral">"Invalid domain name"</span>;
00099     <span class="keywordflow">case</span> <a class="code" href="group__err.html#a16cvqw5">err_user_inv</a>:
00100             <span class="keywordflow">return</span> <span class="stringliteral">"Invalid user name"</span>;
00101     <span class="keywordflow">case</span> <a class="code" href="group__err.html#a16cvqw6">err_user_nf</a>:
00102             <span class="keywordflow">return</span> <span class="stringliteral">"No such user"</span>;
00103     <span class="keywordflow">case</span> <a class="code" href="group__err.html#a16cvqw7">err_auth</a>:
00104             <span class="keywordflow">return</span> <span class="stringliteral">"Error in authorization module"</span>;
00105     <span class="keywordflow">case</span> <a class="code" href="group__err.html#a16cvqw8">err_udot_tns</a>:
00106             <span class="keywordflow">return</span> <span class="stringliteral">"Type's not supported"</span>;
00107     <span class="keywordflow">case</span> <a class="code" href="group__err.html#a16cvqw9">err_open</a>:
00108             <span class="keywordflow">return</span> <span class="stringliteral">"Open failed"</span>;
00109     <span class="keywordflow">case</span> <a class="code" href="group__err.html#a16cvqw10">err_wr</a>:
00110             <span class="keywordflow">return</span> <span class="stringliteral">"Write failed"</span>;
00111     <span class="keywordflow">case</span> <a class="code" href="group__err.html#a16cvqw11">err_rd</a>:
00112             <span class="keywordflow">return</span> <span class="stringliteral">"Read failed"</span>;
00113     <span class="keywordflow">case</span> <a class="code" href="group__err.html#a16cvqw12">err_stat</a>:
00114             <span class="keywordflow">return</span> <span class="stringliteral">"Stat failed"</span>;
00115     <span class="keywordflow">case</span> <a class="code" href="group__err.html#a16cvqw13">err_notdir</a>:
00116             <span class="keywordflow">return</span> <span class="stringliteral">"Not a directory"</span>;
00117     <span class="keywordflow">case</span> <a class="code" href="group__err.html#a16cvqw14">err_chmod</a>:
00118             <span class="keywordflow">return</span> <span class="stringliteral">"Chmod failed"</span>;
00119     <span class="keywordflow">case</span> <a class="code" href="group__err.html#a16cvqw15">err_lckd</a>:
00120             <span class="keywordflow">return</span> <span class="stringliteral">"It's locked"</span>;
00121     <span class="keywordflow">case</span> <a class="code" href="group__err.html#a16cvqw16">err_ren</a>:
00122             <span class="keywordflow">return</span> <span class="stringliteral">"Rename failed"</span>;
00123     <span class="keywordflow">case</span> <a class="code" href="group__err.html#a16cvqw17">err_chown</a>:
00124             <span class="keywordflow">return</span> <span class="stringliteral">"Chown failed"</span>;
00125     <span class="keywordflow">case</span> <a class="code" href="group__err.html#a16cvqw18">err_over</a>:
00126             <span class="keywordflow">return</span> <span class="stringliteral">"Overflow"</span>;
00127     <span class="keywordflow">case</span> <a class="code" href="group__err.html#a16cvqw19">err_exec</a>:
00128             <span class="keywordflow">return</span> <span class="stringliteral">"Child crashed or returned something unexpected"</span>;
00129     <span class="keywordflow">case</span> <a class="code" href="group__err.html#a16cvqw20">err_mkdir</a>:
00130             <span class="keywordflow">return</span> <span class="stringliteral">"Mkdir failed"</span>;
00131     <span class="keywordflow">case</span> <a class="code" href="group__err.html#a16cvqw21">err_exists</a>:
00132             <span class="keywordflow">return</span> <span class="stringliteral">"Entry exists"</span>;
00133     <span class="keywordflow">case</span> <a class="code" href="group__err.html#a16cvqw22">err_noent</a>:
00134             <span class="keywordflow">return</span> <span class="stringliteral">"Entry does not exist"</span>;
00135     <span class="keywordflow">default</span>:
00136             <span class="keywordflow">return</span> <span class="stringliteral">"Unknown error"</span>;
00137     }
00138 }
00139 
<a name="l00143"></a><a class="code" href="classcvq.html#a14">00143</a> string <a class="code" href="group__err.html#a14">cvq::err_info</a>()<span class="keyword"> const </span>{
00144     <span class="keywordflow">return</span> <a class="code" href="group__err.html#a6">lr_info</a>.c_str();
00145 }
00146 
<a name="l00150"></a><a class="code" href="classcvq.html#a13">00150</a> uint8_t <a class="code" href="group__err.html#a13">cvq::lr</a>( uint8_t ret, <span class="keyword">const</span> std::string &amp; msg ) { 
00151         <span class="keywordflow">if</span>( ret != <a class="code" href="group__err.html#a16cvqw2">err_no</a> &amp;&amp; ret != <a class="code" href="group__err.html#a8">lastret</a> &amp;&amp; ! <a class="code" href="group__err.html#a9">lastret_blkd</a> ) {
00152                 <a class="code" href="group__err.html#a8">lastret</a> = ret;
00153                 <a class="code" href="group__err.html#a6">lr_info</a> = msg;
00154                 <a class="code" href="group__err.html#a7">lr_errno</a> = errno;
00155         }
00156         <span class="keywordflow">return</span> ret;
00157 }
00158 
<a name="l00162"></a><a class="code" href="classcvq.html#a20">00162</a> <span class="keywordtype">int</span> <a class="code" href="group__dom.html#a20">cvq::err_sys</a>()<span class="keyword"> const </span>{
00163     <span class="keywordflow">return</span> <a class="code" href="group__err.html#a7">lr_errno</a>;
00164 }
00165 
<a name="l00169"></a><a class="code" href="classcvq.html#a23">00169</a> string <a class="code" href="group__dom.html#a23">cvq::err_report</a>()<span class="keyword"> const </span>{
00170     <span class="keywordflow">return</span> <a class="code" href="group__dom.html#a21">err_str</a>(<a class="code" href="group__err.html#a8">lastret</a>)+<span class="stringliteral">"# "</span>+<a class="code" href="group__err.html#a6">lr_info</a>+<span class="stringliteral">"# "</span>+strerror(<a class="code" href="group__err.html#a7">lr_errno</a>);
00171 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu Dec 25 13:37:10 2003 for Virtual Qmail by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.3 </small></address>
</body>
</html>
