<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>vqwww: freemail: cdbdaemon.cc Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.3 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Compound&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Compound&nbsp;Members</a></div>
<h1>cdbdaemon.cc</h1><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment">Copyright (c) 2002,2003 Pawel Niewiadomski</span>
00003 <span class="comment">All rights reserved.</span>
00004 <span class="comment"></span>
00005 <span class="comment">Redistribution and use in source and binary forms, with or without</span>
00006 <span class="comment">modification, are permitted provided that the following conditions</span>
00007 <span class="comment">are met:</span>
00008 <span class="comment">1. Redistributions of source code must retain the above copyright</span>
00009 <span class="comment">   notice, this list of conditions and the following disclaimer.</span>
00010 <span class="comment">2. Redistributions in binary form must reproduce the above copyright</span>
00011 <span class="comment">   notice, this list of conditions and the following disclaimer in the</span>
00012 <span class="comment">   documentation and/or other materials provided with the distribution.</span>
00013 <span class="comment">3. All advertising materials mentioning features or use of this software</span>
00014 <span class="comment">   must display the following acknowledgement:</span>
00015 <span class="comment">   This product includes software developed by the Pawel Niewiadomski,</span>
00016 <span class="comment">   and other contributors.</span>
00017 <span class="comment">4. Neither the name of Pawel Niewiadomski nor the names of other contributors</span>
00018 <span class="comment">   may be used to endorse or promote products derived from this software</span>
00019 <span class="comment">   without specific prior written permission.</span>
00020 <span class="comment"></span>
00021 <span class="comment">THIS SOFTWARE IS PROVIDED BY PAWEL NIEWIADOMSKI AND CONTRIBUTORS ``AS IS'' AND</span>
00022 <span class="comment">ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span>
00023 <span class="comment">IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</span>
00024 <span class="comment">ARE DISCLAIMED.  IN NO EVENT SHALL PAWEL NIEWIADOMSKI OR CONTRIBUTORS BE LIABLE</span>
00025 <span class="comment">FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL</span>
00026 <span class="comment">DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS</span>
00027 <span class="comment">OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)</span>
00028 <span class="comment">HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT</span>
00029 <span class="comment">LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY</span>
00030 <span class="comment">OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF</span>
00031 <span class="comment">SUCH DAMAGE.</span>
00032 <span class="comment">*/</span>
00033 
00034 <span class="preprocessor">#include &lt;new&gt;</span>
00035 <span class="preprocessor">#include &lt;sys/types.h&gt;</span>
00036 <span class="preprocessor">#include &lt;sys/stat.h&gt;</span>
00037 <span class="preprocessor">#include &lt;sys/socket.h&gt;</span>
00038 <span class="preprocessor">#include &lt;unistd.h&gt;</span>
00039 <span class="preprocessor">#include &lt;errno.h&gt;</span>
00040 <span class="preprocessor">#include &lt;fcntl.h&gt;</span>
00041 
00042 <span class="preprocessor">#include &lt;fd.h&gt;</span>
00043 <span class="preprocessor">#include &lt;fdstr.h&gt;</span>
00044 <span class="preprocessor">#include &lt;lower.h&gt;</span>
00045 
00046 <span class="preprocessor">#include "cdbdaemon.h"</span>
00047 <span class="preprocessor">#include "conf_home.h"</span>
00048 
00049 <span class="keyword">using</span> <span class="keyword">namespace </span>std;
00050 <span class="keyword">using</span> <span class="keyword">namespace </span>freemail;
00051 
<a name="l00055"></a><a class="code" href="classcdbdaemon.html#cdbdaemone0">00055</a> <a class="code" href="classcdbdaemon.html">cdbdaemon</a> * <a class="code" href="classcdbdaemon.html#cdbdaemone0">cdbdaemon::alloc</a>() {
00056     <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classcdbdaemon.html">cdbdaemon</a>();
00057 }
00058 
00059 cdbdaemon::rt_error::rt_error( <span class="keyword">const</span> string &amp; w )
00060         : runtime_error( w ) {
00061 }
00062 
00066 cdbdaemon::cdbdaemon() {
00067     <span class="keywordtype">int</span> curdirfd = open(<span class="stringliteral">"."</span>,O_RDONLY);
00068     <span class="keywordflow">if</span>(curdirfd==-1) 
00069             <span class="keywordflow">throw</span> rt_error((string)<span class="stringliteral">"open: .: "</span>+strerror(errno));
00070     
00071     string dir_dest = conf_home+<span class="stringliteral">"/var/run/vqsignup1d"</span>;
00072     <span class="keywordflow">if</span>(chdir(dir_dest.c_str()))
00073             <span class="keywordflow">throw</span> rt_error((string)<span class="stringliteral">"chdir: "</span>+dir_dest+<span class="stringliteral">": "</span>+strerror(errno));
00074 
00075     <span class="keywordflow">if</span>( (cso=socket(AF_UNIX,SOCK_STREAM,0)) == -1 )
00076             <span class="keywordflow">throw</span> rt_error((string)<span class="stringliteral">"socket: "</span>+strerror(errno));
00077 
00078     string sck_name = <span class="stringliteral">"vqsignup1d.sock"</span>;
00079     cun.sun_family = AF_UNIX;
00080     strcpy(cun.sun_path, sck_name.c_str());
00081     <span class="keywordflow">if</span>(connect(cso, (<span class="keyword">struct</span> sockaddr*) &amp;cun, SUN_LEN(&amp;cun)))
00082             <span class="keywordflow">throw</span> rt_error((string)<span class="stringliteral">"connect: "</span>+sck_name+<span class="stringliteral">": "</span>+strerror(errno));
00083     <span class="keywordflow">if</span>( fchdir(curdirfd) )
00084             <span class="keywordflow">throw</span> rt_error((string)<span class="stringliteral">"fchdir: "</span>+conf_home+<span class="stringliteral">": "</span>+strerror(errno));
00085 }
00086 
00087 cdbdaemon::~cdbdaemon() {
00088     close(cso);
00089 }
00090 
<a name="l00094"></a><a class="code" href="classcdbdaemon.html#cdbdaemona3">00094</a> uint8_t <a class="code" href="classcdbdaemon.html#cdbdaemona3">cdbdaemon::edu_ls</a>( vector&lt;edu_info&gt; &amp; vec ) {
00095  resp = 0;
00096  cmd = <a class="code" href="classcdbdaemon.html#cdbdaemonw25cdbdaemonw0">cmd_edu_ls</a>;
00097  vector&lt;edu_info&gt;::size_type cnt;
00098  <span class="keywordflow">if</span>( fdwrite(cso, &amp;cmd, <span class="keyword">sizeof</span>(cmd)) == <span class="keyword">sizeof</span>(cmd) 
00099      &amp;&amp; fdwrstr(cso, loc) != -1 
00100      &amp;&amp; fdread(cso, &amp;resp, <span class="keyword">sizeof</span>(resp)) == <span class="keyword">sizeof</span>(resp)
00101      &amp;&amp; resp == <span class="charliteral">'F'</span>
00102      &amp;&amp; fdread(cso, &amp;cnt, <span class="keyword">sizeof</span>(cnt)) == <span class="keyword">sizeof</span>(cnt) ) {
00103    
00104    vec.reserve(cnt);
00105    <a class="code" href="structcdbdaemon_1_1edu__info.html">edu_info</a> info;
00106    cnt--;
00107    <span class="keywordflow">do</span> {
00108      <span class="keywordflow">if</span>( fdrdstr(cso, info.<a class="code" href="structcdbdaemon_1_1edu__info.html#cdbdaemon_1_1edu__infoo0">id</a>) == -1 
00109          || fdrdstr(cso, info.<a class="code" href="structcdbdaemon_1_1edu__info.html#cdbdaemon_1_1edu__infoo1">name</a>) == -1 ) <span class="keywordflow">return</span> <a class="code" href="group__err.html#a1cdbdaemonw24">err_read</a>;
00110      vec.push_back(info);
00111    } <span class="keywordflow">while</span>(cnt--);
00112    <span class="keywordflow">return</span> <a class="code" href="group__err.html#a1cdbdaemonw21">err_no</a>;
00113  }
00114  <span class="keywordflow">if</span>(resp == <span class="charliteral">'Z'</span>) <span class="keywordflow">return</span> <a class="code" href="group__err.html#a1cdbdaemonw22">err_empty</a>; 
00115  <span class="keywordflow">return</span> resp ? <a class="code" href="group__err.html#a1cdbdaemonw24">err_read</a> : <a class="code" href="group__err.html#a1cdbdaemonw23">err_write</a>;
00116 }
00117 
<a name="l00121"></a><a class="code" href="classcdbdaemon.html#cdbdaemona5">00121</a> uint8_t <a class="code" href="classcdbdaemon.html#cdbdaemona5">cdbdaemon::int_ls</a>( vector&lt;int_info&gt; &amp; vec ) {
00122  resp = 0;
00123  cmd = <a class="code" href="classcdbdaemon.html#cdbdaemonw25cdbdaemonw2">cmd_int_ls</a>;
00124  vector&lt;int_info&gt;::size_type cnt;
00125  <span class="keywordflow">if</span>( fdwrite(cso, &amp;cmd, <span class="keyword">sizeof</span>(cmd)) == <span class="keyword">sizeof</span>(cmd) 
00126      &amp;&amp; fdwrstr(cso, loc) != -1 
00127      &amp;&amp; fdread(cso, &amp;resp, <span class="keyword">sizeof</span>(resp)) == <span class="keyword">sizeof</span>(resp)
00128      &amp;&amp; resp == <span class="charliteral">'F'</span>
00129      &amp;&amp; fdread(cso, &amp;cnt, <span class="keyword">sizeof</span>(cnt)) == <span class="keyword">sizeof</span>(cnt) ) {
00130    
00131    vec.reserve(cnt);
00132    <a class="code" href="structcdbdaemon_1_1int__info.html">int_info</a> info;
00133    cnt--;
00134    <span class="keywordflow">do</span> {
00135      <span class="keywordflow">if</span>( fdrdstr(cso, info.<a class="code" href="structcdbdaemon_1_1int__info.html#cdbdaemon_1_1int__infoo0">id</a>) == -1 
00136          || fdrdstr(cso, info.<a class="code" href="structcdbdaemon_1_1int__info.html#cdbdaemon_1_1int__infoo1">name</a>) == -1 ) <span class="keywordflow">return</span> <a class="code" href="group__err.html#a1cdbdaemonw24">err_read</a>;
00137      vec.push_back(info);
00138    } <span class="keywordflow">while</span>(cnt--);
00139    <span class="keywordflow">return</span> <a class="code" href="group__err.html#a1cdbdaemonw21">err_no</a>;
00140  }
00141  <span class="keywordflow">if</span>(resp == <span class="charliteral">'Z'</span>) <span class="keywordflow">return</span> <a class="code" href="group__err.html#a1cdbdaemonw22">err_empty</a>; 
00142  <span class="keywordflow">return</span> resp ? <a class="code" href="group__err.html#a1cdbdaemonw24">err_read</a> : <a class="code" href="group__err.html#a1cdbdaemonw23">err_write</a>;
00143 }
00144 
<a name="l00148"></a><a class="code" href="classcdbdaemon.html#cdbdaemona4">00148</a> uint8_t <a class="code" href="classcdbdaemon.html#cdbdaemona4">cdbdaemon::work_ls</a>( vector&lt;work_info&gt; &amp; vec ) {
00149  resp = 0;
00150  cmd = <a class="code" href="classcdbdaemon.html#cdbdaemonw25cdbdaemonw1">cmd_work_ls</a>;
00151  vector&lt;work_info&gt;::size_type cnt;
00152  <span class="keywordflow">if</span>( fdwrite(cso, &amp;cmd, <span class="keyword">sizeof</span>(cmd)) == <span class="keyword">sizeof</span>(cmd) 
00153      &amp;&amp; fdwrstr(cso, loc) != -1 
00154      &amp;&amp; fdread(cso, &amp;resp, <span class="keyword">sizeof</span>(resp)) == <span class="keyword">sizeof</span>(resp)
00155      &amp;&amp; resp == <span class="charliteral">'F'</span>
00156      &amp;&amp; fdread(cso, &amp;cnt, <span class="keyword">sizeof</span>(cnt)) == <span class="keyword">sizeof</span>(cnt) ) {
00157    
00158    vec.reserve(cnt);
00159    <a class="code" href="structcdbdaemon_1_1work__info.html">work_info</a> info;
00160    cnt--;
00161    <span class="keywordflow">do</span> {
00162      <span class="keywordflow">if</span>( fdrdstr(cso, info.<a class="code" href="structcdbdaemon_1_1work__info.html#cdbdaemon_1_1work__infoo0">id</a>) == -1 
00163          || fdrdstr(cso, info.<a class="code" href="structcdbdaemon_1_1work__info.html#cdbdaemon_1_1work__infoo1">name</a>) == -1 ) <span class="keywordflow">return</span> <a class="code" href="group__err.html#a1cdbdaemonw24">err_read</a>;
00164      vec.push_back(info);
00165    } <span class="keywordflow">while</span>(cnt--);
00166    <span class="keywordflow">return</span> <a class="code" href="group__err.html#a1cdbdaemonw21">err_no</a>;
00167  }
00168  <span class="keywordflow">if</span>(resp == <span class="charliteral">'Z'</span>) <span class="keywordflow">return</span> <a class="code" href="group__err.html#a1cdbdaemonw22">err_empty</a>; 
00169  <span class="keywordflow">return</span> resp ? <a class="code" href="group__err.html#a1cdbdaemonw24">err_read</a> : <a class="code" href="group__err.html#a1cdbdaemonw23">err_write</a>;
00170 }
00171 
<a name="l00175"></a><a class="code" href="classcdbdaemon.html#cdbdaemona2">00175</a> <span class="keywordtype">void</span> <a class="code" href="classcdbdaemon.html#cdbdaemona2">cdbdaemon::locale_set</a>( <span class="keyword">const</span> std::string &amp; l ) {
00176  loc = l;
00177 }
00178 
<a name="l00182"></a><a class="code" href="classcdbdaemon.html#cdbdaemona6">00182</a> uint8_t <a class="code" href="classcdbdaemon.html#cdbdaemona6">cdbdaemon::area_ls</a>( vector&lt;area_info&gt; &amp; vec ) {
00183  resp = 0;
00184  cmd = <a class="code" href="classcdbdaemon.html#cdbdaemonw25cdbdaemonw3">cmd_area_ls</a>;
00185  vector&lt;area_info&gt;::size_type cnt;
00186  <span class="keywordflow">if</span>( fdwrite(cso, &amp;cmd, <span class="keyword">sizeof</span>(cmd)) == <span class="keyword">sizeof</span>(cmd) 
00187      &amp;&amp; fdwrstr(cso, loc) != -1 
00188      &amp;&amp; fdread(cso, &amp;resp, <span class="keyword">sizeof</span>(resp)) == <span class="keyword">sizeof</span>(resp)
00189      &amp;&amp; resp == <span class="charliteral">'F'</span>
00190      &amp;&amp; fdread(cso, &amp;cnt, <span class="keyword">sizeof</span>(cnt)) == <span class="keyword">sizeof</span>(cnt) ) {
00191    
00192    vec.reserve(cnt);
00193    <a class="code" href="structcdbdaemon_1_1area__info.html">area_info</a> info;
00194    cnt--;
00195    <span class="keywordflow">do</span> {
00196      <span class="keywordflow">if</span>( fdrdstr(cso, info.<a class="code" href="structcdbdaemon_1_1area__info.html#cdbdaemon_1_1area__infoo0">id</a>) == -1 
00197          || fdrdstr(cso, info.<a class="code" href="structcdbdaemon_1_1area__info.html#cdbdaemon_1_1area__infoo1">name</a>) == -1 ) <span class="keywordflow">return</span> <a class="code" href="group__err.html#a1cdbdaemonw24">err_read</a>;
00198      vec.push_back(info);
00199    } <span class="keywordflow">while</span>(cnt--);
00200    <span class="keywordflow">return</span> <a class="code" href="group__err.html#a1cdbdaemonw21">err_no</a>;
00201  }
00202  <span class="keywordflow">if</span>(resp == <span class="charliteral">'Z'</span>) <span class="keywordflow">return</span> <a class="code" href="group__err.html#a1cdbdaemonw22">err_empty</a>; 
00203  <span class="keywordflow">return</span> resp ? <a class="code" href="group__err.html#a1cdbdaemonw24">err_read</a> : <a class="code" href="group__err.html#a1cdbdaemonw23">err_write</a>;
00204 }
00205 
<a name="l00209"></a><a class="code" href="classcdbdaemon.html#cdbdaemona7">00209</a> uint8_t <a class="code" href="classcdbdaemon.html#cdbdaemona7">cdbdaemon::sex_ls</a>( vector&lt;sex_info&gt; &amp; vec ) {
00210  resp = 0;
00211  cmd = <a class="code" href="classcdbdaemon.html#cdbdaemonw25cdbdaemonw4">cmd_sex_ls</a>;
00212  vector&lt;sex_info&gt;::size_type cnt;
00213  <span class="keywordflow">if</span>( fdwrite(cso, &amp;cmd, <span class="keyword">sizeof</span>(cmd)) == <span class="keyword">sizeof</span>(cmd) 
00214      &amp;&amp; fdwrstr(cso, loc) != -1 
00215      &amp;&amp; fdread(cso, &amp;resp, <span class="keyword">sizeof</span>(resp)) == <span class="keyword">sizeof</span>(resp)
00216      &amp;&amp; resp == <span class="charliteral">'F'</span>
00217      &amp;&amp; fdread(cso, &amp;cnt, <span class="keyword">sizeof</span>(cnt)) == <span class="keyword">sizeof</span>(cnt) ) {
00218    
00219    vec.reserve(cnt);
00220    <a class="code" href="structcdbdaemon_1_1sex__info.html">sex_info</a> info;
00221    cnt--;
00222    <span class="keywordflow">do</span> {
00223      <span class="keywordflow">if</span>( fdrdstr(cso, info.<a class="code" href="structcdbdaemon_1_1sex__info.html#cdbdaemon_1_1sex__infoo0">id</a>) == -1 
00224          || fdrdstr(cso, info.<a class="code" href="structcdbdaemon_1_1sex__info.html#cdbdaemon_1_1sex__infoo1">name</a>) == -1 ) <span class="keywordflow">return</span> <a class="code" href="group__err.html#a1cdbdaemonw24">err_read</a>;
00225      vec.push_back(info);
00226    } <span class="keywordflow">while</span>(cnt--);
00227    <span class="keywordflow">return</span> <a class="code" href="group__err.html#a1cdbdaemonw21">err_no</a>;
00228  }
00229  <span class="keywordflow">if</span>(resp == <span class="charliteral">'Z'</span>) <span class="keywordflow">return</span> <a class="code" href="group__err.html#a1cdbdaemonw22">err_empty</a>; 
00230  <span class="keywordflow">return</span> resp ? <a class="code" href="group__err.html#a1cdbdaemonw24">err_read</a> : <a class="code" href="group__err.html#a1cdbdaemonw23">err_write</a>;
00231 }
00232 
<a name="l00236"></a><a class="code" href="classcdbdaemon.html#cdbdaemona8">00236</a> uint8_t <a class="code" href="classcdbdaemon.html#cdbdaemona8">cdbdaemon::domain_ls</a>( vector&lt;domain_info&gt; &amp; vec ) {
00237  resp = 0;
00238  cmd = <a class="code" href="classcdbdaemon.html#cdbdaemonw25cdbdaemonw5">cmd_dom_ls</a>;
00239  vector&lt;domain_info&gt;::size_type cnt;
00240  <span class="keywordflow">if</span>( fdwrite(cso, &amp;cmd, <span class="keyword">sizeof</span>(cmd)) == <span class="keyword">sizeof</span>(cmd) 
00241      &amp;&amp; fdwrstr(cso, loc) != -1 
00242      &amp;&amp; fdread(cso, &amp;resp, <span class="keyword">sizeof</span>(resp)) == <span class="keyword">sizeof</span>(resp)
00243      &amp;&amp; resp == <span class="charliteral">'F'</span>
00244      &amp;&amp; fdread(cso, &amp;cnt, <span class="keyword">sizeof</span>(cnt)) == <span class="keyword">sizeof</span>(cnt) ) {
00245    
00246    vec.reserve(cnt);
00247    <a class="code" href="structcdbdaemon_1_1domain__info.html">domain_info</a> info;
00248    cnt--;
00249    <span class="keywordflow">do</span> {
00250      <span class="keywordflow">if</span>( fdrdstr(cso, info.<a class="code" href="structcdbdaemon_1_1domain__info.html#cdbdaemon_1_1domain__infoo0">id</a>) == -1 
00251          || fdrdstr(cso, info.<a class="code" href="structcdbdaemon_1_1domain__info.html#cdbdaemon_1_1domain__infoo1">name</a>) == -1 ) <span class="keywordflow">return</span> <a class="code" href="group__err.html#a1cdbdaemonw24">err_read</a>;
00252      vec.push_back(info);
00253    } <span class="keywordflow">while</span>(cnt--);
00254    <span class="keywordflow">return</span> <a class="code" href="group__err.html#a1cdbdaemonw21">err_no</a>;
00255  }
00256  <span class="keywordflow">if</span>(resp == <span class="charliteral">'Z'</span>) <span class="keywordflow">return</span> <a class="code" href="group__err.html#a1cdbdaemonw22">err_empty</a>; 
00257  <span class="keywordflow">return</span> resp ? <a class="code" href="group__err.html#a1cdbdaemonw24">err_read</a> : <a class="code" href="group__err.html#a1cdbdaemonw23">err_write</a>;
00258 }
00259 
00263 uint8_t cdbdaemon::ui_get_by_name( ui_full &amp; ui ) {
00264  vector&lt;int_info&gt;::size_type cnt, i;
00265  int_info inter;
00266  resp = 0;
00267  cmd = <a class="code" href="classcdbdaemon.html#cdbdaemonw25cdbdaemonw10">cmd_ui_get_by_name</a>;
00268  
00269  <span class="keywordflow">if</span>( fdwrite(cso, &amp;cmd, <span class="keyword">sizeof</span>(cmd)) == <span class="keyword">sizeof</span>(cmd) 
00270      &amp;&amp; fdwrstr(cso, loc) != -1 
00271      &amp;&amp; fdwrstr(cso, lower(ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo1">login</a>)) != -1
00272      &amp;&amp; fdwrstr(cso, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo2">dom_id</a>) != -1
00273      &amp;&amp; fdread(cso, &amp;resp, <span class="keyword">sizeof</span>(resp)) == <span class="keyword">sizeof</span>(resp)
00274      &amp;&amp; resp == <span class="charliteral">'F'</span>
00275      &amp;&amp; fdrdstr(cso, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo0">id</a>) != -1
00276      &amp;&amp; fdrdstr(cso, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo3">country</a>) != -1
00277      &amp;&amp; fdrdstr(cso, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo4">city</a>) != -1
00278      &amp;&amp; fdrdstr(cso, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo5">birthday</a>) != -1
00279      &amp;&amp; fdrdstr(cso, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo12">re_que</a>) != -1
00280      &amp;&amp; fdrdstr(cso, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo13">re_ans</a>) != -1
00281      &amp;&amp; fdrdstr(cso, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo10">locale</a>) != -1
00282      &amp;&amp; fdrdstr(cso, ui.area.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo0">id</a>) != -1
00283      &amp;&amp; fdrdstr(cso, ui.area.name) != -1
00284      &amp;&amp; fdrdstr(cso, ui.work.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo0">id</a>) != -1
00285      &amp;&amp; fdrdstr(cso, ui.work.name) != -1
00286      &amp;&amp; fdrdstr(cso, ui.edu.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo0">id</a>) != -1
00287      &amp;&amp; fdrdstr(cso, ui.edu.name) != -1
00288      &amp;&amp; fdrdstr(cso, ui.sex.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo0">id</a>) != -1
00289      &amp;&amp; fdrdstr(cso, ui.sex.name) != -1
00290      &amp;&amp; fdread(cso, &amp;cnt, <span class="keyword">sizeof</span>(cnt)) == <span class="keyword">sizeof</span>(cnt) ) {
00291    
00292    <span class="keywordflow">for</span>( i=0; i &lt; cnt; ++i ) {
00293      <span class="keywordflow">if</span>( fdrdstr(cso, inter.id) == -1 
00294          || fdrdstr(cso, inter.name) == -1 ) <span class="keywordflow">return</span> <a class="code" href="group__err.html#a1cdbdaemonw24">err_read</a>;
00295      ui.ints.push_back(inter);
00296    }
00297    <span class="keywordflow">return</span> <a class="code" href="group__err.html#a1cdbdaemonw21">err_no</a>;
00298  } 
00299  <span class="keywordflow">return</span> resp ? <a class="code" href="group__err.html#a1cdbdaemonw23">err_write</a> : <a class="code" href="group__err.html#a1cdbdaemonw24">err_read</a>;
00300 }
00301 
00305 uint8_t cdbdaemon::ui_get_by_name( user_info &amp; ui ) {
00306  vector&lt;int_info&gt;::size_type cnt, i;
00307  string inter;
00308  resp = 0;
00309  cmd = cmd_ui_get_by_name1;
00310  
00311  <span class="keywordflow">if</span>( fdwrite(cso, &amp;cmd, <span class="keyword">sizeof</span>(cmd)) == <span class="keyword">sizeof</span>(cmd) 
00312      &amp;&amp; fdwrstr(cso, loc) != -1 
00313      &amp;&amp; fdwrstr(cso, lower(ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo1">login</a>)) != -1
00314      &amp;&amp; fdwrstr(cso, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo2">dom_id</a>) != -1
00315      &amp;&amp; fdread(cso, &amp;resp, <span class="keyword">sizeof</span>(resp)) == <span class="keyword">sizeof</span>(resp)
00316      &amp;&amp; resp == <span class="charliteral">'F'</span>
00317      &amp;&amp; fdrdstr(cso, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo0">id</a>) != -1
00318      &amp;&amp; fdrdstr(cso, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo3">country</a>) != -1
00319      &amp;&amp; fdrdstr(cso, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo4">city</a>) != -1
00320      &amp;&amp; fdrdstr(cso, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo5">birthday</a>) != -1
00321      &amp;&amp; fdrdstr(cso, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo12">re_que</a>) != -1
00322      &amp;&amp; fdrdstr(cso, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo13">re_ans</a>) != -1
00323      &amp;&amp; fdrdstr(cso, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo10">locale</a>) != -1
00324      &amp;&amp; fdrdstr(cso, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo6">area_id</a>) != -1
00325      &amp;&amp; fdrdstr(cso, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo7">work_id</a>) != -1
00326      &amp;&amp; fdrdstr(cso, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo8">edu_id</a>) != -1
00327      &amp;&amp; fdrdstr(cso, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo9">sex_id</a>) != -1
00328      &amp;&amp; fdread(cso, &amp;cnt, <span class="keyword">sizeof</span>(cnt)) == <span class="keyword">sizeof</span>(cnt) ) {
00329    
00330    <span class="keywordflow">for</span>( i=0; i &lt; cnt; ++i ) {
00331      <span class="keywordflow">if</span>( fdrdstr(cso, inter) == -1 ) <span class="keywordflow">return</span> <a class="code" href="group__err.html#a1cdbdaemonw24">err_read</a>;
00332      ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo11">ints_id</a>.push_back(inter);
00333    }
00334    <span class="keywordflow">return</span> <a class="code" href="group__err.html#a1cdbdaemonw21">err_no</a>;
00335  } 
00336  <span class="keywordflow">return</span> resp ? <a class="code" href="group__err.html#a1cdbdaemonw23">err_write</a> : <a class="code" href="group__err.html#a1cdbdaemonw24">err_read</a>;
00337 }
00338 
<a name="l00342"></a><a class="code" href="classcdbdaemon.html#cdbdaemona11">00342</a> uint8_t <a class="code" href="classcdbdaemon.html#cdbdaemona11">cdbdaemon::ui_add</a>( <a class="code" href="structcdbdaemon_1_1user__info.html">user_info</a> &amp; ui ) {
00343  vector&lt;int_info&gt;::size_type cnt = ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo11">ints_id</a>.size();
00344  resp = 0;
00345  cmd = <a class="code" href="classcdbdaemon.html#cdbdaemonw25cdbdaemonw6">cmd_ui_add</a>;
00346  
00347  <span class="keywordflow">if</span>( fdwrite(cso, &amp;cmd, <span class="keyword">sizeof</span>(cmd)) == <span class="keyword">sizeof</span>(cmd) 
00348      &amp;&amp; fdwrstr(cso, loc) != -1 
00349      &amp;&amp; fdwrstr(cso, lower(ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo1">login</a>)) != -1
00350      &amp;&amp; fdwrstr(cso, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo2">dom_id</a>) != -1
00351      &amp;&amp; fdwrstr(cso, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo3">country</a>) != -1
00352      &amp;&amp; fdwrstr(cso, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo4">city</a>) != -1
00353      &amp;&amp; fdwrstr(cso, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo5">birthday</a>) != -1
00354      &amp;&amp; fdwrstr(cso, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo6">area_id</a>) != -1
00355      &amp;&amp; fdwrstr(cso, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo7">work_id</a>) != -1
00356      &amp;&amp; fdwrstr(cso, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo8">edu_id</a>) != -1
00357      &amp;&amp; fdwrstr(cso, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo9">sex_id</a>) != -1 
00358      &amp;&amp; fdwrstr(cso, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo12">re_que</a>) != -1
00359      &amp;&amp; fdwrstr(cso, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo13">re_ans</a>) != -1
00360      &amp;&amp; fdwrite(cso, &amp;cnt, <span class="keyword">sizeof</span>(cnt)) == <span class="keyword">sizeof</span>(cnt) ) {
00361    
00362    vector&lt;string&gt;::const_iterator icur = ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo11">ints_id</a>.begin(), iend = ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo11">ints_id</a>.end();
00363    <span class="keywordflow">for</span>( ; icur!=iend; ++icur )
00364      <span class="keywordflow">if</span>( fdwrstr(cso, *icur) == -1 ) <span class="keywordflow">return</span> <a class="code" href="group__err.html#a1cdbdaemonw23">err_write</a>;
00365    <span class="keywordflow">if</span>( fdread(cso, &amp;resp, <span class="keyword">sizeof</span>(resp)) == <span class="keyword">sizeof</span>(resp)
00366        &amp;&amp; resp == <span class="charliteral">'F'</span>
00367        &amp;&amp; fdrdstr(cso, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo0">id</a>) != -1 ) <span class="keywordflow">return</span> <a class="code" href="group__err.html#a1cdbdaemonw21">err_no</a>;
00368  } 
00369  <span class="keywordflow">return</span> resp ? <a class="code" href="group__err.html#a1cdbdaemonw24">err_read</a> : <a class="code" href="group__err.html#a1cdbdaemonw23">err_write</a>;
00370 }
00371 
<a name="l00375"></a><a class="code" href="classcdbdaemon.html#cdbdaemona12">00375</a> uint8_t <a class="code" href="classcdbdaemon.html#cdbdaemona12">cdbdaemon::ui_chg</a>( <span class="keyword">const</span> <a class="code" href="structcdbdaemon_1_1user__info.html">user_info</a> &amp; ui ) {
00376  vector&lt;int_info&gt;::size_type cnt = ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo11">ints_id</a>.size();
00377  resp = 0;
00378  cmd = cmd_ui_chg;
00379  
00380  <span class="keywordflow">if</span>( fdwrite(cso, &amp;cmd, <span class="keyword">sizeof</span>(cmd)) == <span class="keyword">sizeof</span>(cmd) 
00381      &amp;&amp; fdwrstr(cso, loc) != -1 
00382      &amp;&amp; fdwrstr(cso, lower(ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo0">id</a>)) != -1
00383      &amp;&amp; fdwrstr(cso, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo3">country</a>) != -1
00384      &amp;&amp; fdwrstr(cso, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo4">city</a>) != -1
00385      &amp;&amp; fdwrstr(cso, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo5">birthday</a>) != -1
00386      &amp;&amp; fdwrstr(cso, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo6">area_id</a>) != -1
00387      &amp;&amp; fdwrstr(cso, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo7">work_id</a>) != -1
00388      &amp;&amp; fdwrstr(cso, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo8">edu_id</a>) != -1
00389      &amp;&amp; fdwrstr(cso, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo9">sex_id</a>) != -1 
00390      &amp;&amp; fdwrstr(cso, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo12">re_que</a>) != -1
00391      &amp;&amp; fdwrstr(cso, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo13">re_ans</a>) != -1
00392      &amp;&amp; fdwrite(cso, &amp;cnt, <span class="keyword">sizeof</span>(cnt)) == <span class="keyword">sizeof</span>(cnt) ) {
00393    
00394    vector&lt;string&gt;::const_iterator icur = ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo11">ints_id</a>.begin(), iend = ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo11">ints_id</a>.end();
00395    <span class="keywordflow">for</span>( ; icur!=iend; ++icur )
00396      <span class="keywordflow">if</span>( fdwrstr(cso, *icur) == -1 ) <span class="keywordflow">return</span> <a class="code" href="group__err.html#a1cdbdaemonw23">err_write</a>;
00397    <span class="keywordflow">if</span>( fdread(cso, &amp;resp, <span class="keyword">sizeof</span>(resp)) == <span class="keyword">sizeof</span>(resp)
00398        &amp;&amp; resp == <span class="charliteral">'K'</span> ) <span class="keywordflow">return</span> <a class="code" href="group__err.html#a1cdbdaemonw21">err_no</a>;
00399  } 
00400  <span class="keywordflow">return</span> resp ? <a class="code" href="group__err.html#a1cdbdaemonw24">err_read</a> : <a class="code" href="group__err.html#a1cdbdaemonw23">err_write</a>;
00401 }
00402 
00403 
<a name="l00411"></a><a class="code" href="classcdbdaemon.html#cdbdaemona16">00411</a> uint8_t <a class="code" href="classcdbdaemon.html#cdbdaemona16">cdbdaemon::ui_cmp_by_name</a>( <span class="keyword">const</span> <a class="code" href="structcdbdaemon_1_1user__info.html">user_info</a> &amp; ui ) {
00412  resp = 0;
00413  cmd = cmd_ui_cmp_by_name;
00414  
00415  <span class="keywordflow">if</span>( fdwrite(cso, &amp;cmd, <span class="keyword">sizeof</span>(cmd)) == <span class="keyword">sizeof</span>(cmd) 
00416      &amp;&amp; fdwrstr(cso, loc) != -1 
00417      &amp;&amp; fdwrstr(cso, lower(ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo1">login</a>)) != -1
00418      &amp;&amp; fdwrstr(cso, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo2">dom_id</a>) != -1
00419      &amp;&amp; fdwrstr(cso, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo3">country</a>) != -1
00420      &amp;&amp; fdwrstr(cso, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo4">city</a>) != -1
00421      &amp;&amp; fdwrstr(cso, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo5">birthday</a>) != -1
00422      &amp;&amp; fdwrstr(cso, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo6">area_id</a>) != -1
00423      &amp;&amp; fdwrstr(cso, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo7">work_id</a>) != -1
00424      &amp;&amp; fdwrstr(cso, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo8">edu_id</a>) != -1
00425      &amp;&amp; fdwrstr(cso, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo9">sex_id</a>) != -1 
00426      &amp;&amp; fdwrstr(cso, ui.<a class="code" href="structcdbdaemon_1_1user__info.html#cdbdaemon_1_1user__infoo13">re_ans</a>) != -1
00427      &amp;&amp; fdread(cso, &amp;resp, <span class="keyword">sizeof</span>(resp)) == <span class="keyword">sizeof</span>(resp)
00428      &amp;&amp; resp == <span class="charliteral">'K'</span> ) <span class="keywordflow">return</span> <a class="code" href="group__err.html#a1cdbdaemonw21">err_no</a>;
00429  <span class="keywordflow">if</span>( <span class="charliteral">'Z'</span> == resp ) <span class="keywordflow">return</span> <a class="code" href="group__err.html#a1cdbdaemonw22">err_empty</a>;
00430  <span class="keywordflow">return</span> resp ? <a class="code" href="group__err.html#a1cdbdaemonw24">err_read</a> : <a class="code" href="group__err.html#a1cdbdaemonw23">err_write</a>;
00431 }
00432 
00433 
<a name="l00437"></a><a class="code" href="classcdbdaemon.html#cdbdaemona13">00437</a> uint8_t <a class="code" href="classcdbdaemon.html#cdbdaemona13">cdbdaemon::ui_rm</a>( <span class="keyword">const</span> string &amp; id ) {
00438  resp = 0;
00439  cmd = <a class="code" href="classcdbdaemon.html#cdbdaemonw25cdbdaemonw7">cmd_ui_rm</a>;
00440  <span class="keywordflow">if</span>( fdwrite(cso, &amp;cmd, <span class="keyword">sizeof</span>(cmd)) == <span class="keyword">sizeof</span>(cmd) 
00441      &amp;&amp; fdwrstr(cso, id) != -1 
00442      &amp;&amp; fdread(cso, &amp;resp, <span class="keyword">sizeof</span>(resp)) == <span class="keyword">sizeof</span>(resp)
00443      &amp;&amp; resp == <span class="charliteral">'K'</span> ) <span class="keywordflow">return</span> <a class="code" href="group__err.html#a1cdbdaemonw21">err_no</a>;
00444    
00445  <span class="keywordflow">return</span> resp ? <a class="code" href="group__err.html#a1cdbdaemonw24">err_read</a> : <a class="code" href="group__err.html#a1cdbdaemonw23">err_write</a>;
00446 }
00447 
<a name="l00451"></a><a class="code" href="classcdbdaemon.html#cdbdaemona9">00451</a> uint8_t <a class="code" href="classcdbdaemon.html#cdbdaemona9">cdbdaemon::domain_get</a>( <a class="code" href="structcdbdaemon_1_1domain__info.html">domain_info</a> &amp; di ) {
00452  resp = 0;
00453  cmd = <a class="code" href="classcdbdaemon.html#cdbdaemonw25cdbdaemonw8">cmd_dom_get</a>;
00454 
00455  <span class="keywordflow">if</span>( fdwrite(cso, &amp;cmd, <span class="keyword">sizeof</span>(cmd)) == <span class="keyword">sizeof</span>(cmd)
00456      &amp;&amp; fdwrstr(cso, di.<a class="code" href="structcdbdaemon_1_1domain__info.html#cdbdaemon_1_1domain__infoo0">id</a>) != -1
00457      &amp;&amp; fdread(cso, &amp;resp, <span class="keyword">sizeof</span>(resp)) == <span class="keyword">sizeof</span>(resp)
00458      &amp;&amp; resp == <span class="charliteral">'F'</span>
00459      &amp;&amp; fdrdstr(cso, di.<a class="code" href="structcdbdaemon_1_1domain__info.html#cdbdaemon_1_1domain__infoo1">name</a>) != -1 ) {
00460    <span class="keywordflow">return</span> <a class="code" href="group__err.html#a1cdbdaemonw21">err_no</a>;
00461  }
00462  <span class="keywordflow">if</span>( resp == <span class="charliteral">'Z'</span> ) <span class="keywordflow">return</span> <a class="code" href="group__err.html#a1cdbdaemonw22">err_empty</a>;
00463  <span class="keywordflow">return</span> resp ? <a class="code" href="group__err.html#a1cdbdaemonw24">err_read</a> : <a class="code" href="group__err.html#a1cdbdaemonw23">err_write</a>;
00464 }
00465 
00469 uint8_t cdbdaemon::domain_get_by_name( domain_info &amp; di ) {
00470  resp = 0;
00471  cmd = <a class="code" href="classcdbdaemon.html#cdbdaemonw25cdbdaemonw9">cmd_dom_get_by_name</a>;
00472 
00473  <span class="keywordflow">if</span>( fdwrite(cso, &amp;cmd, <span class="keyword">sizeof</span>(cmd)) == <span class="keyword">sizeof</span>(cmd)
00474      &amp;&amp; fdwrstr(cso, lower(di.<a class="code" href="structcdbdaemon_1_1domain__info.html#cdbdaemon_1_1domain__infoo1">name</a>)) != -1
00475      &amp;&amp; fdread(cso, &amp;resp, <span class="keyword">sizeof</span>(resp)) == <span class="keyword">sizeof</span>(resp)
00476      &amp;&amp; resp == <span class="charliteral">'F'</span>
00477      &amp;&amp; fdrdstr(cso, di.<a class="code" href="structcdbdaemon_1_1domain__info.html#cdbdaemon_1_1domain__infoo0">id</a>) != -1 ) {
00478    <span class="keywordflow">return</span> <a class="code" href="group__err.html#a1cdbdaemonw21">err_no</a>;
00479  }
00480  <span class="keywordflow">if</span>( resp == <span class="charliteral">'Z'</span> ) <span class="keywordflow">return</span> <a class="code" href="group__err.html#a1cdbdaemonw22">err_empty</a>;
00481  <span class="keywordflow">return</span> resp ? <a class="code" href="group__err.html#a1cdbdaemonw24">err_read</a> : <a class="code" href="group__err.html#a1cdbdaemonw23">err_write</a>;
00482 }
00483 
00487 uint8_t cdbdaemon::user_pass_get( <span class="keyword">const</span> string &amp;dom, <span class="keyword">const</span> string &amp;user,
00488                 string &amp; pass ) {
00489  resp = 0;
00490  cmd = cmd_user_pass_get;
00491 
00492  <span class="keywordflow">if</span>( fdwrite(cso, &amp;cmd, <span class="keyword">sizeof</span>(cmd)) == <span class="keyword">sizeof</span>(cmd) 
00493      &amp;&amp; fdwrstr(cso, lower(dom)) != -1
00494      &amp;&amp; fdwrstr(cso, lower(user)) != -1 
00495      &amp;&amp; fdread(cso, &amp;resp, <span class="keyword">sizeof</span>(resp)) == <span class="keyword">sizeof</span>(resp)
00496      &amp;&amp; resp == <span class="charliteral">'F'</span> 
00497      &amp;&amp; fdrdstr(cso, pass) != -1 ) {
00498    <span class="keywordflow">return</span> <a class="code" href="group__err.html#a1cdbdaemonw21">err_no</a>;
00499  }
00500  <span class="keywordflow">if</span>( resp == <span class="charliteral">'Z'</span> ) <span class="keywordflow">return</span> <a class="code" href="group__err.html#a1cdbdaemonw22">err_empty</a>;
00501  <span class="keywordflow">return</span> resp ? <a class="code" href="group__err.html#a1cdbdaemonw24">err_read</a> : <a class="code" href="group__err.html#a1cdbdaemonw23">err_write</a>;
00502 }
<a name="l00506"></a><a class="code" href="classcdbdaemon.html#cdbdaemona17">00506</a> uint8_t <a class="code" href="classcdbdaemon.html#cdbdaemona17">cdbdaemon::ui_re_que_get_by_name</a>( <span class="keyword">const</span> string &amp; dom_id, <span class="keyword">const</span> string &amp; login,
00507                string &amp;que) {
00508  resp = 0;
00509  cmd = cmd_ui_re_que_get_by_name;
00510 
00511  <span class="keywordflow">if</span>( fdwrite(cso, &amp;cmd, <span class="keyword">sizeof</span>(cmd)) == <span class="keyword">sizeof</span>(cmd)
00512      &amp;&amp; fdwrstr(cso, dom_id) != -1 
00513      &amp;&amp; fdwrstr(cso, lower(login)) != -1 
00514      &amp;&amp; fdread(cso, &amp;resp, <span class="keyword">sizeof</span>(resp)) == <span class="keyword">sizeof</span>(resp)
00515      &amp;&amp; resp == <span class="charliteral">'F'</span>
00516      &amp;&amp; fdrdstr(cso, que) != -1 ) {
00517    <span class="keywordflow">return</span> <a class="code" href="group__err.html#a1cdbdaemonw21">err_no</a>;
00518  }
00519  <span class="keywordflow">if</span>( resp == <span class="charliteral">'Z'</span> ) <span class="keywordflow">return</span> <a class="code" href="group__err.html#a1cdbdaemonw22">err_empty</a>;
00520  <span class="keywordflow">return</span> resp ? <a class="code" href="group__err.html#a1cdbdaemonw24">err_read</a> : <a class="code" href="group__err.html#a1cdbdaemonw23">err_write</a>;
00521 }
00522 <span class="preprocessor">#if 0</span>
00523 <span class="preprocessor"></span>
00526 uint8_t cdbdaemon::ui_edu_get( <span class="keyword">const</span> string &amp;uid, edu_info &amp; info ) {
00527  resp = 0;
00528  cmd = cmd_ui_edu_get;
00529  <span class="keywordflow">if</span>( fdwrite(cso, &amp;cmd, <span class="keyword">sizeof</span>(cmd)) == <span class="keyword">sizeof</span>(cmd)
00530      &amp;&amp; fdwrstr(cso, loc) != -1
00531      &amp;&amp; fdwrstr(cso, uid) != -1
00532      &amp;&amp; fdread(cso, &amp;resp, <span class="keyword">sizeof</span>(resp)) == <span class="keyword">sizeof</span>(resp) 
00533      &amp;&amp; resp == <span class="charliteral">'F'</span> 
00534      &amp;&amp; fdrdstr(cso, info.id) != -1
00535      &amp;&amp; fdrdstr(cso, info.name) != -1 ) {
00536    <span class="keywordflow">return</span> <a class="code" href="group__err.html#a1cdbdaemonw21">err_no</a>;
00537  }
00538  <span class="keywordflow">return</span> resp ? <a class="code" href="group__err.html#a1cdbdaemonw23">err_write</a> : <a class="code" href="group__err.html#a1cdbdaemonw24">err_read</a>;
00539 }
00540 
00544 uint8_t cdbdaemon::ui_work_get( <span class="keyword">const</span> string &amp;uid, work_info &amp; info ) {
00545  resp = 0;
00546  cmd = cmd_ui_work_get;
00547  <span class="keywordflow">if</span>( fdwrite(cso, &amp;cmd, <span class="keyword">sizeof</span>(cmd)) == <span class="keyword">sizeof</span>(cmd)
00548      &amp;&amp; fdwrstr(cso, loc) != -1
00549      &amp;&amp; fdwrstr(cso, uid) != -1
00550      &amp;&amp; fdread(cso, &amp;resp, <span class="keyword">sizeof</span>(resp)) == <span class="keyword">sizeof</span>(resp) 
00551      &amp;&amp; resp == <span class="charliteral">'F'</span> 
00552      &amp;&amp; fdrdstr(cso, info.id) != -1
00553      &amp;&amp; fdrdstr(cso, info.name) != -1 ) {
00554    <span class="keywordflow">return</span> <a class="code" href="group__err.html#a1cdbdaemonw21">err_no</a>;
00555  }
00556  <span class="keywordflow">return</span> resp ? <a class="code" href="group__err.html#a1cdbdaemonw23">err_write</a> : <a class="code" href="group__err.html#a1cdbdaemonw24">err_read</a>;
00557 }
00558 
00562 uint8_t cdbdaemon::ui_area_get( <span class="keyword">const</span> string &amp;uid, area_info &amp; info ) {
00563  resp = 0;
00564  cmd = cmd_ui_area_get;
00565  <span class="keywordflow">if</span>( fdwrite(cso, &amp;cmd, <span class="keyword">sizeof</span>(cmd)) == <span class="keyword">sizeof</span>(cmd)
00566      &amp;&amp; fdwrstr(cso, loc) != -1
00567      &amp;&amp; fdwrstr(cso, uid) != -1
00568      &amp;&amp; fdread(cso, &amp;resp, <span class="keyword">sizeof</span>(resp)) == <span class="keyword">sizeof</span>(resp) 
00569      &amp;&amp; resp == <span class="charliteral">'F'</span> 
00570      &amp;&amp; fdrdstr(cso, info.id) != -1
00571      &amp;&amp; fdrdstr(cso, info.name) != -1 ) {
00572    <span class="keywordflow">return</span> <a class="code" href="group__err.html#a1cdbdaemonw21">err_no</a>;
00573  }
00574  <span class="keywordflow">return</span> resp ? <a class="code" href="group__err.html#a1cdbdaemonw23">err_write</a> : <a class="code" href="group__err.html#a1cdbdaemonw24">err_read</a>;
00575 }
00576 
00580 uint8_t cdbdaemon::ui_sex_get( <span class="keyword">const</span> string &amp;uid, sex_info &amp; info ) {
00581  resp = 0;
00582  cmd = cmd_ui_sex_get;
00583  <span class="keywordflow">if</span>( fdwrite(cso, &amp;cmd, <span class="keyword">sizeof</span>(cmd)) == <span class="keyword">sizeof</span>(cmd)
00584      &amp;&amp; fdwrstr(cso, loc) != -1
00585      &amp;&amp; fdwrstr(cso, uid) != -1
00586      &amp;&amp; fdread(cso, &amp;resp, <span class="keyword">sizeof</span>(resp)) == <span class="keyword">sizeof</span>(resp) 
00587      &amp;&amp; resp == <span class="charliteral">'F'</span> 
00588      &amp;&amp; fdrdstr(cso, info.id) != -1
00589      &amp;&amp; fdrdstr(cso, info.name) != -1 ) {
00590    <span class="keywordflow">return</span> <a class="code" href="group__err.html#a1cdbdaemonw21">err_no</a>;
00591  }
00592  <span class="keywordflow">return</span> resp ? <a class="code" href="group__err.html#a1cdbdaemonw23">err_write</a> : <a class="code" href="group__err.html#a1cdbdaemonw24">err_read</a>;
00593 }
00594 
00598 uint8_t cdbdaemon::ui_ints_get( <span class="keyword">const</span> string &amp;uid, vector&lt;int_info&gt; &amp; infos ) {
00599  int_info info;
00600  vector&lt;int_info&gt;::size_type cnt;
00601  
00602  infos.clear();
00603  resp = 0;
00604  cmd = cmd_ui_ints_get;
00605  <span class="keywordflow">if</span>( fdwrite(cso, &amp;cmd, <span class="keyword">sizeof</span>(cmd)) == <span class="keyword">sizeof</span>(cmd)
00606      &amp;&amp; fdwrstr(cso, loc) != -1
00607      &amp;&amp; fdwrstr(cso, uid) != -1 
00608      &amp;&amp; fdread(cso, &amp;resp, <span class="keyword">sizeof</span>(resp)) == <span class="keyword">sizeof</span>(resp)
00609      &amp;&amp; resp = <span class="charliteral">'F'</span>
00610      &amp;&amp; fdread(cso, &amp;cnt, <span class="keyword">sizeof</span>(cnt)) == <span class="keyword">sizeof</span>(cnt)) {
00611    cnt--;
00612    <span class="keywordflow">do</span> {
00613      <span class="keywordflow">if</span>( fdrdstr(cso, info.id) == -1 
00614          || fdrdstr(cso, info.name) == -1 ) <span class="keywordflow">return</span> <a class="code" href="group__err.html#a1cdbdaemonw24">err_read</a>;
00615    } <span class="keywordflow">while</span>(cnt--);
00616    <span class="keywordflow">return</span> <a class="code" href="group__err.html#a1cdbdaemonw21">err_no</a>;
00617  }
00618  <span class="keywordflow">if</span>( <span class="charliteral">'Z'</span> == resp ) <span class="keywordflow">return</span> <a class="code" href="group__err.html#a1cdbdaemonw22">err_empty</a>;
00619  <span class="keywordflow">return</span> resp ? <a class="code" href="group__err.html#a1cdbdaemonw23">err_write</a> : <a class="code" href="group__err.html#a1cdbdaemonw24">err_read</a>;
00620 }
00621 <span class="preprocessor">#endif</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu Dec 25 13:37:18 2003 for vqwww: freemail by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.3 </small></address>
</body>
</html>
