<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Virtual Qmail: cdaemonauth.cc Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.3 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Compound&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Compound&nbsp;Members</a></div>
<h1>cdaemonauth.cc</h1><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment">Copyright (c) 2002 Pawel Niewiadomski</span>
00003 <span class="comment">All rights reserved.</span>
00004 <span class="comment"></span>
00005 <span class="comment">Redistribution and use in source and binary forms, with or without</span>
00006 <span class="comment">modification, are permitted provided that the following conditions</span>
00007 <span class="comment">are met:</span>
00008 <span class="comment">1. Redistributions of source code must retain the above copyright</span>
00009 <span class="comment">   notice, this list of conditions and the following disclaimer.</span>
00010 <span class="comment">2. Redistributions in binary form must reproduce the above copyright</span>
00011 <span class="comment">   notice, this list of conditions and the following disclaimer in the</span>
00012 <span class="comment">   documentation and/or other materials provided with the distribution.</span>
00013 <span class="comment">3. All advertising materials mentioning features or use of this software</span>
00014 <span class="comment">   must display the following acknowledgement:</span>
00015 <span class="comment">   This product includes software developed by the Pawel Niewiadomski,</span>
00016 <span class="comment">   and other contributors.</span>
00017 <span class="comment">4. Neither the name of Pawel Niewiadomski nor the names of other contributors</span>
00018 <span class="comment">   may be used to endorse or promote products derived from this software</span>
00019 <span class="comment">   without specific prior written permission.</span>
00020 <span class="comment"></span>
00021 <span class="comment">THIS SOFTWARE IS PROVIDED BY PAWEL NIEWIADOMSKI AND CONTRIBUTORS ``AS IS'' AND</span>
00022 <span class="comment">ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span>
00023 <span class="comment">IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</span>
00024 <span class="comment">ARE DISCLAIMED.  IN NO EVENT SHALL PAWEL NIEWIADOMSKI OR CONTRIBUTORS BE LIABLE</span>
00025 <span class="comment">FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL</span>
00026 <span class="comment">DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS</span>
00027 <span class="comment">OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)</span>
00028 <span class="comment">HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT</span>
00029 <span class="comment">LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY</span>
00030 <span class="comment">OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF</span>
00031 <span class="comment">SUCH DAMAGE.</span>
00032 <span class="comment">*/</span>
00033 
00034 <span class="preprocessor">#include &lt;sys/types.h&gt;</span>
00035 <span class="preprocessor">#include &lt;sys/stat.h&gt;</span>
00036 <span class="preprocessor">#include &lt;sys/socket.h&gt;</span>
00037 <span class="preprocessor">#include &lt;unistd.h&gt;</span>
00038 <span class="preprocessor">#include &lt;cerrno&gt;</span>
00039 <span class="preprocessor">#include &lt;fcntl.h&gt;</span>
00040 
00041 <span class="preprocessor">#include "cdaemonauth.h"</span>
00042 <span class="preprocessor">#include "conf_home.h"</span>
00043 <span class="preprocessor">#include "fd.h"</span>
00044 <span class="preprocessor">#include "fdstr.h"</span>
00045 <span class="preprocessor">#include "lower.h"</span>
00046 
00047 <span class="keyword">using</span> <span class="keyword">namespace </span>std;
00048 <span class="keyword">using</span> <span class="keyword">namespace </span>vq;
00049 
<a name="l00053"></a><a class="code" href="classcauth.html#cdaemonauthe0">00053</a> <a class="code" href="classcauth.html">cauth</a> * <a class="code" href="classcauth.html#cdaemonauthe0">cauth::alloc</a>() {
00054     <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classcdaemonauth.html">cdaemonauth</a>();
00055 }
00056 
<a name="l00060"></a><a class="code" href="classcdaemonauth.html#cdaemonautha0">00060</a> <a class="code" href="classcdaemonauth.html#cdaemonautha0">cdaemonauth::cdaemonauth</a>()
00061 {
00062     <span class="keywordtype">int</span> curdirfd = open(<span class="stringliteral">"."</span>,O_RDONLY);
00063     <span class="keywordflow">if</span>(curdirfd==-1) 
00064             <span class="keywordflow">throw</span> runtime_error((string)<span class="stringliteral">"cdaemonauth: open current dir: "</span>+strerror(errno));
00065     <span class="keywordflow">if</span>(chdir((conf_home+<span class="stringliteral">"/sockets"</span>).c_str()))
00066             <span class="keywordflow">throw</span> runtime_error((string)<span class="stringliteral">"cdaemonauth: chdir: "</span>
00067                     +conf_home+<span class="stringliteral">"/sockets: "</span>+strerror(errno));
00068     <span class="keywordflow">if</span>( (<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>=socket(AF_UNIX,SOCK_STREAM,0)) == -1 )
00069             <span class="keywordflow">throw</span> runtime_error((string)<span class="stringliteral">"cdaemonauth: socket: "</span>+strerror(errno));
00070     <a class="code" href="classcdaemonauth.html#cdaemonauthp3">cun</a>.sun_family = AF_UNIX;
00071     strcpy(<a class="code" href="classcdaemonauth.html#cdaemonauthp3">cun</a>.sun_path, <span class="stringliteral">"daemonauth"</span>);
00072     <span class="keywordflow">if</span>(connect(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, (<span class="keyword">struct</span> sockaddr*) &amp;<a class="code" href="classcdaemonauth.html#cdaemonauthp3">cun</a>, SUN_LEN(&amp;cun)))
00073             <span class="keywordflow">throw</span> runtime_error((string)<span class="stringliteral">"cdaemonauth: connect: daemonauth: "</span>+strerror(errno));
00074     <span class="keywordflow">if</span>( fchdir(curdirfd) )
00075             <span class="keywordflow">throw</span> runtime_error((string)<span class="stringliteral">"cdaemonauth: fchdir: "</span>+conf_home
00076                     +<span class="stringliteral">": "</span>+strerror(errno));
00077 }
00078 
00081 cdaemonauth::~cdaemonauth()
00082 {
00083     close(cso);
00084 }
<a name="l00087"></a><a class="code" href="classcdaemonauth.html#a7">00087</a> uint8_t <a class="code" href="group__dom.html#a7">cdaemonauth::dom_add</a>( <span class="keyword">const</span> string &amp; dom ) {
00088     <span class="keywordtype">char</span> <a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a>=0;
00089     <a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a> = cmd_dom_add; 
00090     <span class="keywordflow">if</span>( fdwrite(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, &amp;<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>, <span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>)) == <span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>)
00091         &amp;&amp; fdwrstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, lower(dom)) != -1
00092         &amp;&amp; fdread(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, &amp;resp, <span class="keyword">sizeof</span>(resp)) == <span class="keyword">sizeof</span>(resp)
00093         &amp;&amp; resp == <span class="charliteral">'K'</span> ) <span class="keywordflow">return</span> <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw2">cvq::err_no</a>);
00094     
00095     <span class="keywordflow">return</span> ! resp ? <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw11">cvq::err_rd</a>) : <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw3">cvq::err_temp</a>);
00096 }
00097 
<a name="l00100"></a><a class="code" href="classcdaemonauth.html#a29">00100</a> uint8_t <a class="code" href="group__dom.html#a29">cdaemonauth::dom_rm</a>( <span class="keyword">const</span> string &amp; dom )
00101 {
00102     <span class="keywordtype">char</span> <a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a>=0;
00103     <a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a> = cmd_dom_rm;
00104     <span class="keywordflow">if</span>( fdwrite(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, &amp;<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>, <span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>)) == <span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>)
00105         &amp;&amp; fdwrstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, lower(dom)) != -1
00106         &amp;&amp; fdread(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, &amp;resp, <span class="keyword">sizeof</span>(resp)) == <span class="keyword">sizeof</span>(resp)
00107         &amp;&amp; resp == <span class="charliteral">'K'</span> ) <span class="keywordflow">return</span> <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw2">cvq::err_no</a>);
00108     
00109     <span class="keywordflow">return</span> ! resp ? <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw11">cvq::err_rd</a>) : <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw3">cvq::err_temp</a>);
00110 }
<a name="l00118"></a><a class="code" href="classcdaemonauth.html#a5">00118</a> uint8_t <a class="code" href="group__user.html#a5">cdaemonauth::user_add</a>( <span class="keyword">const</span> string &amp; u, <span class="keyword">const</span> string &amp; dom, 
00119         <span class="keyword">const</span> string &amp; p, uint8_t flags )
00120 {
00121     <span class="keywordtype">char</span> <a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a>=0;
00122     <a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a> = cmd_user_add;
00123     <span class="keywordflow">if</span>( fdwrite(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, &amp;<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>, <span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>)) == <span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>)
00124         &amp;&amp; fdwrstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, lower(u)) != -1
00125         &amp;&amp; fdwrstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, lower(dom)) != -1
00126         &amp;&amp; fdwrstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, p) != -1
00127         &amp;&amp; fdwrite(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, &amp;flags, <span class="keyword">sizeof</span>(flags)) == <span class="keyword">sizeof</span>(flags)
00128         &amp;&amp; fdread(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, &amp;resp, <span class="keyword">sizeof</span>(resp)) == <span class="keyword">sizeof</span>(resp)
00129         &amp;&amp; resp == <span class="charliteral">'K'</span> ) <span class="keywordflow">return</span> <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw2">cvq::err_no</a>);
00130     
00131     <span class="keywordflow">if</span>( ! resp ) {
00132             <span class="keywordflow">return</span> <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw11">cvq::err_rd</a>);
00133     } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( resp == <span class="charliteral">'D'</span> ) {
00134             <span class="keywordflow">return</span> <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw5">cvq::err_user_inv</a>, u);
00135     }
00136     <span class="keywordflow">return</span> <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw3">cvq::err_temp</a>);
00137 }
<a name="l00140"></a><a class="code" href="classcdaemonauth.html#a13">00140</a> uint8_t <a class="code" href="group__user.html#a13">cdaemonauth::user_rm</a>(<span class="keyword">const</span> string &amp; u, <span class="keyword">const</span> string &amp; dom ) {
00141     <span class="keywordtype">char</span> <a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a>=0;
00142     <a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a> = cmd_user_rm;
00143     <span class="keywordflow">if</span>( fdwrite(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, &amp;<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>, <span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>)) == <span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>)
00144         &amp;&amp; fdwrstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, lower(u)) != -1
00145         &amp;&amp; fdwrstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, lower(dom)) != -1
00146         &amp;&amp; fdread(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, &amp;resp, <span class="keyword">sizeof</span>(resp)) == <span class="keyword">sizeof</span>(resp)
00147         &amp;&amp; resp == <span class="charliteral">'K'</span> ) <span class="keywordflow">return</span> <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw2">cvq::err_no</a>);
00148     
00149     <span class="keywordflow">return</span> ! resp ? <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw11">cvq::err_rd</a>) : <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw3">cvq::err_temp</a>);
00150 }
<a name="l00153"></a><a class="code" href="classcdaemonauth.html#a14">00153</a> uint8_t <a class="code" href="group__user.html#a14">cdaemonauth::user_pass</a>( <span class="keyword">const</span> string &amp; u, <span class="keyword">const</span> string &amp; dom, 
00154         <span class="keyword">const</span> string &amp; p ) {
00155     <span class="keywordtype">char</span> <a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a>=0;
00156     <a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a> = cmd_user_pass;
00157     <span class="keywordflow">if</span>( fdwrite(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, &amp;<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>, <span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>)) == <span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>)
00158         &amp;&amp; fdwrstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, lower(u)) != -1
00159         &amp;&amp; fdwrstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, lower(dom)) != -1
00160         &amp;&amp; fdwrstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, p) != -1
00161         &amp;&amp; fdread(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, &amp;resp, <span class="keyword">sizeof</span>(resp)) == <span class="keyword">sizeof</span>(resp)
00162         &amp;&amp; resp == <span class="charliteral">'K'</span> ) <span class="keywordflow">return</span> <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw2">cvq::err_no</a>);
00163     
00164     <span class="keywordflow">return</span> ! resp ? <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw11">cvq::err_rd</a>) : <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw3">cvq::err_temp</a>);
00165 }
00166 
<a name="l00169"></a><a class="code" href="classcdaemonauth.html#a15">00169</a> uint8_t <a class="code" href="group__user.html#a15">cdaemonauth::user_auth</a>(<a class="code" href="structcvq_1_1auth__info.html">cvq::auth_info</a> &amp; ai) {
00170     <span class="keywordtype">char</span> <a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a>=0;
00171     <a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a> = cmd_user_auth;
00172     <span class="keywordflow">if</span>( fdwrite(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, &amp;<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>, <span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>)) == <span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>)
00173         &amp;&amp; fdwrstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, lower(ai.<a class="code" href="structcvq_1_1auth__info.html#cvq_1_1auth__infoo0">user</a>)) != -1
00174         &amp;&amp; fdwrstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, lower(ai.<a class="code" href="structcvq_1_1auth__info.html#cvq_1_1auth__infoo2">dom</a>)) != -1
00175         &amp;&amp; fdread(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, &amp;resp, <span class="keyword">sizeof</span>(resp)) != -1
00176         &amp;&amp; resp==<span class="charliteral">'F'</span>
00177         &amp;&amp; fdrdstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, ai.<a class="code" href="structcvq_1_1auth__info.html#cvq_1_1auth__infoo0">user</a>) != -1
00178         &amp;&amp; fdrdstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, ai.<a class="code" href="structcvq_1_1auth__info.html#cvq_1_1auth__infoo2">dom</a>) != -1 
00179         &amp;&amp; fdrdstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, ai.<a class="code" href="structcvq_1_1auth__info.html#cvq_1_1auth__infoo1">pass</a>) != -1
00180         &amp;&amp; fdread(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>,&amp;ai.<a class="code" href="structcvq_1_1auth__info.html#cvq_1_1auth__infoo4">flags</a>,<span class="keyword">sizeof</span>(ai.<a class="code" href="structcvq_1_1auth__info.html#cvq_1_1auth__infoo4">flags</a>)) != -1 ) <span class="keywordflow">return</span> <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw2">cvq::err_no</a>);
00181     
00182     <span class="keywordflow">if</span>( ! resp ) {
00183             <span class="keywordflow">return</span> <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw11">cvq::err_rd</a>);
00184     } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(resp == <span class="charliteral">'E'</span>) {
00185             <span class="keywordflow">return</span> <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw3">cvq::err_temp</a>);
00186     }
00187     <span class="keywordflow">return</span> <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw6">cvq::err_user_nf</a>);
00188 }
<a name="l00191"></a><a class="code" href="classcdaemonauth.html#a24">00191</a> uint8_t <a class="code" href="group__dom.html#a24">cdaemonauth::dom_ip_add</a>(<span class="keyword">const</span> string &amp;dom, <span class="keyword">const</span> string &amp;ip) {
00192     <span class="keywordtype">char</span> <a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a>=0;
00193     <a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a> = cmd_dom_ip_add;
00194     <span class="keywordflow">if</span>( fdwrite(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>,&amp;<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>,<span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>)) == <span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>)
00195         &amp;&amp; fdwrstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>,lower(dom)) != -1
00196         &amp;&amp; fdwrstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>,lower(ip)) != -1
00197         &amp;&amp; fdread(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>,&amp;resp,<span class="keyword">sizeof</span>(resp)) != -1
00198         &amp;&amp; resp == <span class="charliteral">'K'</span> ) <span class="keywordflow">return</span> <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw2">cvq::err_no</a>);
00199     
00200     <span class="keywordflow">return</span> !resp ? <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw11">cvq::err_rd</a>) : <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw3">cvq::err_temp</a>);
00201 }
00202 
<a name="l00205"></a><a class="code" href="classcdaemonauth.html#a25">00205</a> uint8_t <a class="code" href="group__dom.html#a25">cdaemonauth::dom_ip_rm</a>(<span class="keyword">const</span> string &amp;dom,<span class="keyword">const</span> string &amp;ip) {
00206     <span class="keywordtype">char</span> <a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a>=0;
00207     <a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a> = cmd_dom_ip_rm;
00208     <span class="keywordflow">if</span>( fdwrite(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>,&amp;<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>,<span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>)) == <span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>)
00209         &amp;&amp; fdwrstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>,lower(dom)) != -1
00210         &amp;&amp; fdwrstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>,lower(ip)) != -1
00211         &amp;&amp; fdread(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>,&amp;resp,<span class="keyword">sizeof</span>(resp)) != -1 
00212         &amp;&amp; resp == <span class="charliteral">'K'</span> ) <span class="keywordflow">return</span> <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw2">cvq::err_no</a>);
00213     
00214     <span class="keywordflow">return</span> !resp ? <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw2">cvq::err_no</a>) : <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw3">cvq::err_temp</a>);
00215 }
00216 
<a name="l00219"></a><a class="code" href="classcdaemonauth.html#a28">00219</a> uint8_t <a class="code" href="group__dom.html#a28">cdaemonauth::dom_ip_rm_all</a>(<span class="keyword">const</span> string &amp;dom) {
00220     <span class="keywordtype">char</span> <a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a>=0;
00221     <a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a> = cmd_dom_ip_rm_all;
00222     <span class="keywordflow">if</span>( fdwrite(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>,&amp;<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>,<span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>)) == <span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>)
00223         &amp;&amp; fdwrstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>,lower(dom)) != -1
00224         &amp;&amp; fdread(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>,&amp;resp,<span class="keyword">sizeof</span>(resp)) != -1 
00225         &amp;&amp; resp == <span class="charliteral">'K'</span> ) <span class="keywordflow">return</span> <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw2">cvq::err_no</a>);
00226     
00227     <span class="keywordflow">return</span> !resp ? <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw2">cvq::err_no</a>) : <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw3">cvq::err_temp</a>);
00228 }
<a name="l00231"></a><a class="code" href="classcdaemonauth.html#a26">00231</a> uint8_t <a class="code" href="group__dom.html#a26">cdaemonauth::dom_ip_ls</a>(<span class="keyword">const</span> string &amp;dom, vector&lt;string&gt; &amp;ips) {
00232     <span class="keywordtype">char</span> <a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a>=0;
00233     vector&lt;string&gt;::size_type cnt;
00234     <a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a> = cmd_dom_ip_ls;
00235     ips.clear();
00236     <span class="keywordflow">if</span>( fdwrite(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, &amp;<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>,<span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>)) == <span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>) 
00237         &amp;&amp; fdwrstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, lower(dom)) != -1
00238         &amp;&amp; fdread(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>,&amp;resp,<span class="keyword">sizeof</span>(resp)) != -1
00239         &amp;&amp; resp == <span class="charliteral">'F'</span>
00240         &amp;&amp; fdread(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, &amp;cnt, <span class="keyword">sizeof</span>(cnt)) != -1 ) {
00241             ips.reserve(cnt);
00242             <span class="keywordflow">if</span>(cnt--) {
00243                     string ip;
00244                     <span class="keywordflow">do</span> {
00245                             <span class="keywordflow">if</span>( fdrdstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, ip) == -1 )
00246                                     <span class="keywordflow">return</span> <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw11">cvq::err_rd</a>);
00247                             ips.push_back(ip);
00248                     } <span class="keywordflow">while</span>(cnt--);
00249             }
00250             <span class="keywordflow">return</span> <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw2">cvq::err_no</a>);
00251     }
00252     
00253     <span class="keywordflow">return</span> !resp ? <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw2">cvq::err_no</a>) : <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw3">cvq::err_temp</a>);
00254 }
<a name="l00257"></a><a class="code" href="classcdaemonauth.html#a27">00257</a> uint8_t <a class="code" href="group__dom.html#a27">cdaemonauth::dom_ip_ls_dom</a>(vector&lt;string&gt; &amp; doms) {
00258     <span class="keywordtype">char</span> <a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a>=0;
00259     vector&lt;string&gt;::size_type cnt;
00260     <a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a> = cmd_dom_ip_ls_dom;
00261     doms.clear();
00262     <span class="keywordflow">if</span>( fdwrite(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, &amp;<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>,<span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>)) == <span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>) 
00263         &amp;&amp; fdread(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>,&amp;resp,<span class="keyword">sizeof</span>(resp)) != -1
00264         &amp;&amp; resp == <span class="charliteral">'F'</span>
00265         &amp;&amp; fdread(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, &amp;cnt, <span class="keyword">sizeof</span>(cnt)) != -1 ) {
00266             doms.reserve(cnt);
00267             <span class="keywordflow">if</span>(cnt--) {
00268                     string dom;
00269                     <span class="keywordflow">do</span> {
00270                             <span class="keywordflow">if</span>( fdrdstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, dom) == -1 )
00271                                     <span class="keywordflow">return</span> <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw11">cvq::err_rd</a>);
00272                             doms.push_back(dom);
00273                     } <span class="keywordflow">while</span>(cnt--);
00274             }
00275             <span class="keywordflow">return</span> <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw2">cvq::err_no</a>);
00276     }
00277 
00278     <span class="keywordflow">return</span> !resp ? <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw11">cvq::err_rd</a>) : <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw3">cvq::err_temp</a>);
00279 }
<a name="l00283"></a><a class="code" href="classcdaemonauth.html#a9">00283</a> uint8_t <a class="code" href="group__udot.html#a9">cdaemonauth::udot_add</a>(<span class="keyword">const</span> string &amp;dom, <span class="keyword">const</span> string &amp;user,
00284         <span class="keyword">const</span> string &amp;ext, <a class="code" href="structcvq_1_1udot__info.html">cvq::udot_info</a> &amp; ui ) {
00285     <span class="keywordtype">char</span> <a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a>=0;
00286     <a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a> = cmd_udot_add;
00287     <span class="keywordflow">if</span>( fdwrite(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>,&amp;<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>,<span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>)) == <span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>)
00288         &amp;&amp; fdwrstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, lower(dom)) != -1
00289         &amp;&amp; fdwrstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, lower(user)) != -1
00290         &amp;&amp; fdwrstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, lower(ext)) != -1
00291         &amp;&amp; fdwrite(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, &amp;ui.<a class="code" href="structcvq_1_1udot__info.html#cvq_1_1udot__infoo2">type</a>, <span class="keyword">sizeof</span>(ui.<a class="code" href="structcvq_1_1udot__info.html#cvq_1_1udot__infoo2">type</a>)) != -1
00292         &amp;&amp; fdwrstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, ui.<a class="code" href="structcvq_1_1udot__info.html#cvq_1_1udot__infoo1">val</a>) != -1
00293         &amp;&amp; fdread(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>,&amp;resp,<span class="keyword">sizeof</span>(resp)) != -1 
00294         &amp;&amp; resp == <span class="charliteral">'F'</span>
00295         &amp;&amp; fdrdstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, ui.<a class="code" href="structcvq_1_1udot__info.html#cvq_1_1udot__infoo0">id</a>) != -1) <span class="keywordflow">return</span> <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw2">cvq::err_no</a>);
00296 
00297     <span class="keywordflow">return</span> !resp ? <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw11">cvq::err_rd</a>) : <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw3">cvq::err_temp</a>);
00298 }
<a name="l00302"></a><a class="code" href="classcdaemonauth.html#a23">00302</a> uint8_t <a class="code" href="group__udot.html#a23">cdaemonauth::udot_rm</a>(<span class="keyword">const</span> string &amp;dom, <span class="keyword">const</span> string &amp;id) {
00303     <span class="keywordtype">char</span> <a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a>=0;
00304     <a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a> = cmd_udot_rm;
00305     <span class="keywordflow">if</span>( fdwrite(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, &amp;<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>, <span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>)) == <span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>)
00306         &amp;&amp; fdwrstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, lower(dom)) != -1
00307         &amp;&amp; fdwrstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, id) != -1
00308         &amp;&amp; fdread(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, &amp;resp, <span class="keyword">sizeof</span>(resp)) != -1
00309         &amp;&amp; resp == <span class="charliteral">'K'</span> ) <span class="keywordflow">return</span> <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw2">cvq::err_no</a>);
00310 
00311     <span class="keywordflow">return</span> !resp ? <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw11">cvq::err_rd</a>) : <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw3">cvq::err_temp</a>);
00312 }
<a name="l00316"></a><a class="code" href="classcdaemonauth.html#a24">00316</a> uint8_t <a class="code" href="group__udot.html#a23">cdaemonauth::udot_rm</a>(<span class="keyword">const</span> string &amp;dom, <span class="keyword">const</span> string &amp;user, <span class="keyword">const</span> string &amp;ext,
00317         cvq::udot_type type ) {
00318      <a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a> = 0;
00319      <a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a> = cmd_udot_rm_type;
00320      <span class="keywordflow">if</span>( fdwrite(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, &amp;<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>, <span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>)) == <span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>)
00321          &amp;&amp; fdwrstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, lower(dom)) != -1
00322          &amp;&amp; fdwrstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, lower(user)) != -1 
00323          &amp;&amp; fdwrstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, lower(ext)) != -1 
00324          &amp;&amp; fdwrite(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, &amp;type, <span class="keyword">sizeof</span>(type)) == <span class="keyword">sizeof</span>(type)
00325          &amp;&amp; fdread(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, &amp;<a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a>, <span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a>)) == <span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a>)
00326          &amp;&amp; <span class="charliteral">'K'</span> == <a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a> ) <span class="keywordflow">return</span> <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw2">cvq::err_no</a>);
00327 
00328      <span class="keywordflow">return</span> !<a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a> ? <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw11">cvq::err_rd</a>) : <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw3">cvq::err_temp</a>);
00329 }
<a name="l00333"></a><a class="code" href="classcdaemonauth.html#a25">00333</a> uint8_t <a class="code" href="group__udot.html#a25">cdaemonauth::udot_ls</a>(<span class="keyword">const</span> string &amp;dom, <span class="keyword">const</span> string &amp;user,
00334         <span class="keyword">const</span> string &amp;ext, vector&lt;cvq::udot_info&gt; &amp; dots ) {
00335     <a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a> = 0;
00336     <a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a> = cmd_udot_ls;
00337     vector&lt;string&gt;::size_type cnt;
00338     dots.clear();
00339     <span class="keywordflow">if</span>( fdwrite(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, &amp;<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>, <span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>)) == <span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>)
00340         &amp;&amp; fdwrstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, lower(dom)) != -1
00341         &amp;&amp; fdwrstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, lower(user)) != -1
00342         &amp;&amp; fdwrstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, lower(ext)) != -1 
00343         &amp;&amp; fdread(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, &amp;<a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a>, <span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a>)) == <span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a>)
00344         &amp;&amp; <a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a> == <span class="charliteral">'F'</span> 
00345         &amp;&amp; fdread(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, &amp;cnt, <span class="keyword">sizeof</span>(cnt)) == <span class="keyword">sizeof</span>(cnt) ) {
00346             dots.reserve(cnt);
00347             <span class="keywordflow">if</span>(cnt--) {
00348                     <a class="code" href="structcvq_1_1udot__info.html">cvq::udot_info</a> ui;
00349                     <span class="keywordflow">do</span> {
00350                             <span class="keywordflow">if</span>( fdrdstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, ui.<a class="code" href="structcvq_1_1udot__info.html#cvq_1_1udot__infoo0">id</a>) == -1
00351                                 || fdread(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, &amp;ui.<a class="code" href="structcvq_1_1udot__info.html#cvq_1_1udot__infoo2">type</a>, <span class="keyword">sizeof</span>(ui.<a class="code" href="structcvq_1_1udot__info.html#cvq_1_1udot__infoo2">type</a>)) != <span class="keyword">sizeof</span>(ui.<a class="code" href="structcvq_1_1udot__info.html#cvq_1_1udot__infoo2">type</a>)
00352                                 || fdrdstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, ui.<a class="code" href="structcvq_1_1udot__info.html#cvq_1_1udot__infoo1">val</a>) == -1 )
00353                                     <span class="keywordflow">return</span> <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw11">cvq::err_rd</a>);
00354                             dots.push_back(ui);
00355                     } <span class="keywordflow">while</span>(cnt--);
00356             }
00357             <span class="keywordflow">return</span> <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw2">cvq::err_no</a>);
00358     }
00359 
00360     <span class="keywordflow">return</span> !<a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a> ? <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw2">cvq::err_no</a>) : <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw3">cvq::err_temp</a>);
00361 }
<a name="l00365"></a><a class="code" href="classcdaemonauth.html#a26">00365</a> uint8_t <a class="code" href="group__udot.html#a25">cdaemonauth::udot_ls</a>(<span class="keyword">const</span> string &amp;dom, <span class="keyword">const</span> string &amp;user,
00366         <span class="keyword">const</span> string &amp;ext, cvq::udot_type type, vector&lt;cvq::udot_info&gt; &amp; dots ) {
00367     <a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a> = 0;
00368     <a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a> = cmd_udot_ls_type;
00369     vector&lt;string&gt;::size_type cnt;
00370     dots.clear();
00371     <span class="keywordflow">if</span>( fdwrite(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, &amp;<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>, <span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>)) == <span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>)
00372         &amp;&amp; fdwrstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, lower(dom)) != -1
00373         &amp;&amp; fdwrstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, lower(user)) != -1
00374         &amp;&amp; fdwrstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, lower(ext)) != -1 
00375         &amp;&amp; fdwrite(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, &amp;type, <span class="keyword">sizeof</span>(type)) != -1
00376         &amp;&amp; fdread(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, &amp;<a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a>, <span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a>)) == <span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a>)
00377         &amp;&amp; <a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a> == <span class="charliteral">'F'</span> 
00378         &amp;&amp; fdread(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, &amp;cnt, <span class="keyword">sizeof</span>(cnt)) == <span class="keyword">sizeof</span>(cnt) ) {
00379             dots.reserve(cnt);
00380             <span class="keywordflow">if</span>(cnt--) {
00381                     <a class="code" href="structcvq_1_1udot__info.html">cvq::udot_info</a> ui;
00382                     <span class="keywordflow">do</span> {
00383                             <span class="keywordflow">if</span>( fdrdstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, ui.<a class="code" href="structcvq_1_1udot__info.html#cvq_1_1udot__infoo0">id</a>) == -1
00384                                 || fdread(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, &amp;ui.<a class="code" href="structcvq_1_1udot__info.html#cvq_1_1udot__infoo2">type</a>, <span class="keyword">sizeof</span>(ui.<a class="code" href="structcvq_1_1udot__info.html#cvq_1_1udot__infoo2">type</a>)) != <span class="keyword">sizeof</span>(ui.<a class="code" href="structcvq_1_1udot__info.html#cvq_1_1udot__infoo2">type</a>)
00385                                 || fdrdstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, ui.<a class="code" href="structcvq_1_1udot__info.html#cvq_1_1udot__infoo1">val</a>) == -1 )
00386                                     <span class="keywordflow">return</span> <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw11">cvq::err_rd</a>);
00387                             dots.push_back(ui);
00388                     } <span class="keywordflow">while</span>(cnt--);
00389             }
00390             <span class="keywordflow">return</span> <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw2">cvq::err_no</a>);
00391     }
00392 
00393     <span class="keywordflow">return</span> !<a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a> ? <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw11">cvq::err_rd</a>) : <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw3">cvq::err_temp</a>);
00394 }
<a name="l00398"></a><a class="code" href="classcdaemonauth.html#a27">00398</a> uint8_t <a class="code" href="group__udot.html#a27">cdaemonauth::udot_rep</a>(<span class="keyword">const</span> string &amp;dom, <span class="keyword">const</span> <a class="code" href="structcvq_1_1udot__info.html">cvq::udot_info</a> &amp; ui) {
00399     <a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a> = 0;
00400     <a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a> = cmd_udot_rep;
00401     <span class="keywordflow">if</span>( fdwrite(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, &amp;<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>, <span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>)) == <span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>)
00402        &amp;&amp; fdwrstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, lower(dom)) != -1
00403        &amp;&amp; fdwrstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, ui.<a class="code" href="structcvq_1_1udot__info.html#cvq_1_1udot__infoo0">id</a>) != -1
00404        &amp;&amp; fdwrite(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, &amp;ui.<a class="code" href="structcvq_1_1udot__info.html#cvq_1_1udot__infoo2">type</a>, <span class="keyword">sizeof</span>(ui.<a class="code" href="structcvq_1_1udot__info.html#cvq_1_1udot__infoo2">type</a>)) == <span class="keyword">sizeof</span>(ui.<a class="code" href="structcvq_1_1udot__info.html#cvq_1_1udot__infoo2">type</a>)
00405        &amp;&amp; fdwrstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, ui.<a class="code" href="structcvq_1_1udot__info.html#cvq_1_1udot__infoo1">val</a>) != -1 
00406        &amp;&amp; fdread(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, &amp;<a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a>, <span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a>)) == <span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a>) 
00407        &amp;&amp; <a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a>==<span class="charliteral">'K'</span> ) {
00408             <span class="keywordflow">return</span> <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw2">cvq::err_no</a>);
00409     }
00410     
00411     <span class="keywordflow">if</span>(!<a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a>) {
00412             <span class="keywordflow">return</span> <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw11">cvq::err_rd</a>);
00413     } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a> == <span class="charliteral">'Z'</span> ) {
00414             <span class="keywordflow">return</span> <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw22">cvq::err_noent</a>);
00415     } <span class="keywordflow">else</span> {
00416             <span class="keywordflow">return</span> <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw3">cvq::err_temp</a>);
00417     }
00418 }
<a name="l00422"></a><a class="code" href="classcdaemonauth.html#a28">00422</a> uint8_t <a class="code" href="group__udot.html#a28">cdaemonauth::udot_get</a>(<span class="keyword">const</span> string &amp;dom,
00423         <a class="code" href="structcvq_1_1udot__info.html">cvq::udot_info</a> &amp;ui) {
00424     <a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a> = 0;
00425     <a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a> = cmd_udot_get;
00426     <span class="keywordflow">if</span>( fdwrite(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, &amp;<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>, <span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>)) == <span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>)
00427         &amp;&amp; fdwrstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, lower(dom)) != -1
00428         &amp;&amp; fdwrstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, ui.<a class="code" href="structcvq_1_1udot__info.html#cvq_1_1udot__infoo0">id</a>) != -1
00429         &amp;&amp; fdread(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, &amp;<a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a>, <span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a>)) != -1
00430         &amp;&amp; <a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a> == <span class="charliteral">'F'</span>
00431         &amp;&amp; fdread(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, &amp;ui.<a class="code" href="structcvq_1_1udot__info.html#cvq_1_1udot__infoo2">type</a>, <span class="keyword">sizeof</span>(ui.<a class="code" href="structcvq_1_1udot__info.html#cvq_1_1udot__infoo2">type</a>)) != -1
00432         &amp;&amp; fdrdstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, ui.<a class="code" href="structcvq_1_1udot__info.html#cvq_1_1udot__infoo1">val</a>) != -1) {
00433             <span class="keywordflow">return</span> <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw2">cvq::err_no</a>);
00434     }
00435     <span class="keywordflow">if</span>(!<a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a>) {
00436             <span class="keywordflow">return</span> <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw11">cvq::err_rd</a>);
00437     } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a> == <span class="charliteral">'Z'</span>) {
00438             <span class="keywordflow">return</span> <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw22">cvq::err_noent</a>);
00439     } <span class="keywordflow">else</span> {
00440             <span class="keywordflow">return</span> <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw3">cvq::err_temp</a>);
00441     }
00442 }
00443 
<a name="l00447"></a><a class="code" href="classcdaemonauth.html#a29">00447</a> uint8_t <a class="code" href="group__udot.html#a29">cdaemonauth::udot_has</a>(<span class="keyword">const</span> string &amp;dom, <span class="keyword">const</span> string &amp;user, <span class="keyword">const</span> string &amp;ext,
00448         cvq::udot_type type ) {
00449     <a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a> = 0;
00450     <a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a> = cmd_udot_has;
00451     <span class="keywordflow">if</span>( fdwrite(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, &amp;<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>, <span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>)) == <span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>)
00452         &amp;&amp; fdwrstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, lower(dom)) != -1
00453         &amp;&amp; fdwrstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, lower(user)) != -1
00454         &amp;&amp; fdwrstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, lower(ext)) != -1
00455         &amp;&amp; fdwrite(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, &amp;type, <span class="keyword">sizeof</span>(type)) == <span class="keyword">sizeof</span>(type)
00456         &amp;&amp; fdread(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, &amp;<a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a>, <span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a>)) == <span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a>) ) {
00457         <span class="keywordflow">switch</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a>) {
00458         <span class="keywordflow">case</span> <span class="charliteral">'F'</span>: <span class="keywordflow">return</span> <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw22">cvq::err_noent</a>);
00459         <span class="keywordflow">case</span> <span class="charliteral">'T'</span>: <span class="keywordflow">return</span> <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw2">cvq::err_no</a>);
00460         }
00461     }
00462     <span class="keywordflow">return</span> <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw11">cvq::err_rd</a>);
00463 }
00464 
<a name="l00468"></a><a class="code" href="classcdaemonauth.html#a30">00468</a> uint8_t <a class="code" href="group__udot.html#a30">cdaemonauth::udot_type_cnt</a>(<span class="keyword">const</span> string &amp;dom, <span class="keyword">const</span> string &amp;user, 
00469         <span class="keyword">const</span> string &amp;ext, cvq::udot_type type, cvq::size_type &amp; cnt ) {
00470     <a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a> = 0;
00471     <a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a> = cmd_udot_type_cnt;
00472     <span class="keywordflow">if</span>( fdwrite(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, &amp;<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>, <span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>)) == <span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>)
00473         &amp;&amp; fdwrstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, lower(dom)) != -1 
00474         &amp;&amp; fdwrstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, lower(user)) != -1 
00475         &amp;&amp; fdwrstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, lower(ext)) != -1
00476         &amp;&amp; fdwrite(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, &amp;type, <span class="keyword">sizeof</span>(type)) == <span class="keyword">sizeof</span>(type)
00477         &amp;&amp; fdread(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, &amp;<a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a>, <span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a>)) == <span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a>)
00478         &amp;&amp; <a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a> == <span class="charliteral">'F'</span>
00479         &amp;&amp; fdread(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, &amp;cnt, <span class="keyword">sizeof</span>(cnt)) == <span class="keyword">sizeof</span>(cnt) ) {
00480             <span class="keywordflow">return</span> <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw2">cvq::err_no</a>);
00481     }
00482 
00483     <span class="keywordflow">return</span> ! <a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a> ? <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw11">cvq::err_rd</a>) : <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw3">cvq::err_temp</a>);
00484 }
00485 
<a name="l00489"></a><a class="code" href="classcdaemonauth.html#a16">00489</a> uint8_t <a class="code" href="group__user.html#a16">cdaemonauth::user_ex</a>(<span class="keyword">const</span> string &amp;dom, <span class="keyword">const</span> string &amp;user) {
00490     uint8_t ret;
00491     
00492     <a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a> = 0;
00493     <a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a> = cmd_user_ex;
00494     <span class="keywordflow">if</span>( fdwrite(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, &amp;<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>, <span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>)) == <span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp0">cmd</a>)
00495         &amp;&amp; fdwrstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, lower(dom)) != -1
00496         &amp;&amp; fdwrstr(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, lower(user)) != -1
00497         &amp;&amp; fdread(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, &amp;<a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a>, <span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a>)) == <span class="keyword">sizeof</span>(<a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a>)
00498         &amp;&amp; <a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a> == <span class="charliteral">'F'</span>
00499         &amp;&amp; fdread(<a class="code" href="classcdaemonauth.html#cdaemonauthp2">cso</a>, &amp;ret, <span class="keyword">sizeof</span>(ret)) == <span class="keyword">sizeof</span>(ret) ) <span class="keywordflow">return</span> <a class="code" href="group__err.html#a10">lr</a>(ret);
00500 
00501     <span class="keywordflow">return</span> ! <a class="code" href="classcdaemonauth.html#cdaemonauthp1">resp</a> ? <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw11">cvq::err_rd</a>) : <a class="code" href="group__err.html#a10">lr</a>(<a class="code" href="group__err.html#a16cvqw3">cvq::err_temp</a>);
00502 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu Dec 25 13:37:10 2003 for Virtual Qmail by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.3 </small></address>
</body>
</html>
